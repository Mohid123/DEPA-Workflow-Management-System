"use strict";(self.webpackChunkDEPA_FRONTEND=self.webpackChunkDEPA_FRONTEND||[]).push([[911],{39911:(Ue,R,a)=>{a.r(R),a.d(R,{WorkflowsModule:()=>y});var d=a(36895),m=a(19132),U=a(4266),t=a(94650);class b{constructor(o){this.router=o;let e=(0,U.rV)(U.MX.workflowID)||"";"/submodule/submissions"==this.router.url&&this.router.navigate(["/submodule/submissions/view-submissions",e])}}b.\u0275fac=function(o){return new(o||b)(t.Y36(m.F0))},b.\u0275cmp=t.Xpm({type:b,selectors:[["app-workflows"]],decls:1,vars:0,template:function(o,e){1&o&&t._UZ(0,"router-outlet")},dependencies:[m.lC]});var u=a(90433),$=a(1163),ht=a(39646),g=a(77579),S=a(61135),c=a(82722),G=a(94813),w=a(54004),J=a(63900),_t=a(95698),k=a(34782),bt=a(61005),wt=a(80529),Q=a(22603);class f extends bt.s{constructor(o,e){super(o),this.http=o,this.notif=e}getWorkflowSubmission(o){return this.get(`/submissions/${o}`).pipe((0,k.d)(),(0,w.U)(e=>{if(!e.hasErrors())return e.data;e.errors[0].code&&![401,403].includes(e.errors[0].code)&&this.notif.displayNotification("Failed to fetch workflow","Get Submodule workflow","error")}))}getSubmissionFromSubModule(o,e,n,s,r){const l={subModuleId:o,limit:e,page:n,sortBy:r||void 0,submissionStatus:s||void 0};return null==l.submissionStatus&&delete l.submissionStatus,null==l.sortBy&&delete l.sortBy,this.get("/submissions",l).pipe((0,k.d)(),(0,w.U)(p=>p.hasErrors()?p.errors[0].code&&![401,403].includes(p.errors[0].code)?this.notif.displayNotification("Failed to fetch workflow","Get Submodule workflow","error"):void 0:p.data))}updateSubmissionWorkflow(o,e){return this.patch(`/submissions/${o}`,e).pipe((0,k.d)(),(0,w.U)(n=>n.hasErrors()?n.errors[0].code&&![401,403].includes(n.errors[0].code)?this.notif.displayNotification(n.errors[0]?.error?.message,"Update Submission","error"):void 0:(this.notif.displayNotification("Descision made, Workflow updated.","Update Submission","success"),n.data)))}addNewSubmission(o){return this.post("/submissions",o).pipe((0,k.d)(),(0,w.U)(e=>e.hasErrors()?e.errors[0].code&&![401,403].includes(e.errors[0].code)?this.notif.displayNotification(e.errors[0]?.error?.message,"Create Submission","error"):void 0:(this.notif.displayNotification("Submission created successfully","Create Submission","success"),e.data)))}updateFormsData(o,e){return this.patch(`/formsData/${e}`,o).pipe((0,k.d)(),(0,w.U)(n=>n.hasErrors()?n.errors[0].code&&![401,403].includes(n.errors[0].code)?this.notif.displayNotification(n.errors[0]?.error?.message,"Update Forms Data","error"):void 0:(this.notif.displayNotification("Form data updated successfully","Update Forms data","success"),n.data)))}}f.\u0275fac=function(o){return new(o||f)(t.LFG(wt.eN),t.LFG(Q.T))},f.\u0275prov=t.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"});var L=a(15274),O=a(56546),V=a(5754),E=a(60101),D=a(67155),W=a(35601),M=a(70655),H=a(68702),K=a(79982),X=a(88261),tt=a(80063),et=a(1054),vt=a(39255),xt=a(37414),N=a(68923);let yt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({}),i})();var F=a(87819),C=a(8276),ot=a(47846),kt=a(82302),it=a(89740);const Ct=["focusableElement"];function Tt(i,o){if(1&i&&t._UZ(0,"tui-loader",7),2&i){const e=t.oxw();t.Q6J("size",e.loaderSize)("inheritColor",!0)("showLoader",e.checked)}}function Zt(i,o){1&i&&t._UZ(0,"tui-svg",10),2&i&&t.Q6J("src",o.polymorpheusOutlet)}const nt=function(i){return{$implicit:i}};function It(i,o){if(1&i&&(t.TgZ(0,"span",8),t.YNc(1,Zt,1,1,"tui-svg",9),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("polymorpheusOutlet",e.iconOn)("polymorpheusOutletContext",t.VKq(2,nt,e.size))}}function At(i,o){if(1&i&&t._UZ(0,"tui-loader",7),2&i){const e=t.oxw();t.Q6J("size",e.loaderSize)("inheritColor",!0)("showLoader",!e.checked)}}function Ut(i,o){1&i&&t._UZ(0,"tui-svg",12),2&i&&t.Q6J("src",o.polymorpheusOutlet)}function St(i,o){if(1&i&&(t.TgZ(0,"span",8),t.YNc(1,Ut,1,1,"tui-svg",11),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("polymorpheusOutlet",e.iconOff)("polymorpheusOutletContext",t.VKq(2,nt,e.size))}}const st={icons:{toggleOff:({$implicit:i})=>"m"===i?"tuiIconToggleOff":"tuiIconToggleOffLarge",toggleOn:({$implicit:i})=>"m"===i?"tuiIconToggleOn":"tuiIconToggleOnLarge"},singleColor:!1,showIcons:!1,size:"m"},rt=new t.OlP("[TUI_TOGGLE_OPTIONS]",{factory:()=>st});let Ot=(()=>{class i extends et.M${constructor(e,n,s,r){super(e,n),this.modeDirective=s,this.options=r,this.singleColor=this.options.singleColor,this.showIcons=this.options.showIcons,this.showLoader=!1,this.size=this.options.size}get iconOn(){return this.options.icons.toggleOn}get iconOff(){return this.options.icons.toggleOff}get nativeFocusableElement(){return this.focusableElement?this.focusableElement.nativeElement:null}get focused(){return(0,vt.V8)(this.nativeFocusableElement)}get appearance(){return this.singleColor||this.checked?"primary":"secondary"}get sizeM(){return"m"===this.size}get checked(){return this.value}get loaderSize(){return this.sizeM?"xs":"s"}get hostMode(){return this.modeDirective?this.modeDirective.mode:null}onChecked(e){this.updateValue(e)}onFocused(e){this.updateFocused(e)}onFocusVisible(e){this.updateFocusVisible(e)}getFallbackValue(){return!1}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.a5,10),t.Y36(t.sBO),t.Y36(kt.w,8),t.Y36(rt))},i.\u0275cmp=t.Xpm({type:i,selectors:[["tui-toggle"]],viewQuery:function(e,n){if(1&e&&t.Gf(Ct,5),2&e){let s;t.iGM(s=t.CRH())&&(n.focusableElement=s.first)}},hostVars:4,hostBindings:function(e,n){2&e&&(t.uIk("data-size",n.size)("data-mode",n.hostMode),t.ekj("_checked",n.checked))},inputs:{singleColor:"singleColor",showIcons:"showIcons",showLoader:"showLoader",size:"size"},features:[t._Bn([(0,xt.FT)(i),(0,et.wB)(i)]),t.qOj],decls:9,vars:16,consts:[["tuiWrapper","",3,"appearance","readOnly","disabled","focus","hover","active","invalid"],[1,"t-toggle"],["class","t-loader",3,"size","inheritColor","showLoader",4,"ngIf"],["class","t-icon-wrapper",4,"ngIf"],[1,"t-circle"],["type","checkbox","role","switch","automation-id","tui-toggle__checkbox",1,"t-checkbox",3,"id","disabled","tuiChecked","tuiFocusable","tuiCheckedChange","tuiFocusedChange","tuiFocusVisibleChange"],["focusableElement",""],[1,"t-loader",3,"size","inheritColor","showLoader"],[1,"t-icon-wrapper"],["automation-id","tui-toggle__check-icon","class","t-icon",3,"src",4,"polymorpheusOutlet","polymorpheusOutletContext"],["automation-id","tui-toggle__check-icon",1,"t-icon",3,"src"],["automation-id","tui-toggle__cancel-icon","class","t-icon t-icon_off",3,"src",4,"polymorpheusOutlet","polymorpheusOutletContext"],["automation-id","tui-toggle__cancel-icon",1,"t-icon","t-icon_off",3,"src"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,Tt,1,3,"tui-loader",2),t.YNc(3,It,2,4,"span",3),t._UZ(4,"div",4),t.YNc(5,At,1,3,"tui-loader",2),t.YNc(6,St,2,4,"span",3),t.qZA(),t.TgZ(7,"input",5,6),t.NdJ("tuiCheckedChange",function(r){return n.onChecked(r)})("tuiFocusedChange",function(r){return n.onFocused(r)})("tuiFocusVisibleChange",function(r){return n.onFocusVisible(r)}),t.qZA()()),2&e&&(t.Q6J("appearance",n.appearance)("readOnly",n.readOnly)("disabled",n.computedDisabled)("focus",n.computedFocusVisible)("hover",n.pseudoHover)("active",n.pseudoActive)("invalid",n.computedInvalid),t.xp6(2),t.Q6J("ngIf",n.showLoader),t.xp6(1),t.Q6J("ngIf",n.showIcons&&!n.showLoader),t.xp6(2),t.Q6J("ngIf",n.showLoader),t.xp6(1),t.Q6J("ngIf",n.showIcons&&!n.showLoader),t.xp6(1),t.Q6J("id",n.id)("disabled",n.disabled)("tuiChecked",n.checked)("tuiFocusable",n.focusable),t.uIk("aria-checked",n.value))},dependencies:[F.kM,C.PN,ot.o,d.O5,it.Li,H.t,K.t,X.U,tt.q],styles:["[_nghost-%COMP%]{position:relative;display:inline-block;vertical-align:middle;overflow:hidden;border-radius:6.25rem}[data-size=m][_nghost-%COMP%]{width:2rem;height:1rem}[data-size=l][_nghost-%COMP%]{width:3rem;height:1.5rem}.t-checkbox[_ngcontent-%COMP%]{padding:0;margin:0;border:0;border-radius:inherit;background:none;font-size:inherit;line-height:inherit;font-weight:inherit;color:inherit;caret-color:currentColor;outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;word-break:keep-all;-webkit-text-fill-color:currentColor;position:absolute;top:0;left:0;height:100%;width:100%;opacity:0;cursor:pointer}.t-checkbox[_ngcontent-%COMP%]:-webkit-autofill, .t-checkbox[_ngcontent-%COMP%]:-webkit-autofill:hover, .t-checkbox[_ngcontent-%COMP%]:-webkit-autofill:focus{caret-color:var(--tui-base-09);border-radius:inherit;color:inherit!important;background-color:transparent!important;-webkit-text-fill-color:var(--tui-text-01)!important;border-color:var(--tui-autofill);-webkit-box-shadow:0 0 0 100rem var(--tui-autofill) inset!important}._disabled[_nghost-%COMP%]   .t-checkbox[_ngcontent-%COMP%]{pointer-events:none;cursor:default}.t-toggle[_ngcontent-%COMP%]{transition-property:transform;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;display:flex;align-items:center;justify-content:center}[data-size=m][_nghost-%COMP%]   .t-toggle[_ngcontent-%COMP%]{width:3rem;height:1rem;transform:translate(-1rem)}[data-size=l][_nghost-%COMP%]   .t-toggle[_ngcontent-%COMP%]{width:4.5rem;height:1.5rem;transform:translate(-1.5rem)}._checked[_nghost-%COMP%]   .t-toggle[_ngcontent-%COMP%]{transform:translate(0)}.t-circle[_ngcontent-%COMP%]{margin:.125rem 0;flex-shrink:0;border-radius:100%;background-color:var(--tui-base-01)}._disabled[_nghost-%COMP%]   .t-circle_light[_ngcontent-%COMP%]{opacity:.24}[data-size=m][_nghost-%COMP%]   .t-circle[_ngcontent-%COMP%]{width:.75rem;height:.75rem}[data-size=l][_nghost-%COMP%]   .t-circle[_ngcontent-%COMP%]{width:1rem;height:1rem}._disabled[_nghost-%COMP%]   .t-circle[_ngcontent-%COMP%]{background-color:var(--tui-base-01)}[_nghost-%COMP%]:not(._checked)   .t-loader[_ngcontent-%COMP%]{color:var(--tui-base-06)}[_nghost-%COMP%]:not(._checked)._disabled   .t-loader[_ngcontent-%COMP%]{color:var(--tui-base-05)}[_nghost-%COMP%]:not(._checked)[data-mode=onDark]   .t-loader[_ngcontent-%COMP%]{color:var(--tui-text-03-night)}[_nghost-%COMP%]:not(._checked)[data-mode=onDark]._disabled   .t-loader[_ngcontent-%COMP%]{color:var(--tui-clear-inverse-active)}[_nghost-%COMP%]:not(._checked)[data-mode=onLight]   .t-loader[_ngcontent-%COMP%]{color:var(--tui-text-03)}[_nghost-%COMP%]:not(._checked)[data-mode=onLight]._disabled   .t-loader[_ngcontent-%COMP%]{color:var(--tui-clear-active)}[data-size=m][_nghost-%COMP%]   .t-loader[_ngcontent-%COMP%]{width:.75rem;margin:0 .2rem;transform:scale(.75)}[data-size=l][_nghost-%COMP%]   .t-loader[_ngcontent-%COMP%]{width:1rem;margin:0 .25rem}.t-icon-wrapper[_ngcontent-%COMP%]{display:flex}.t-icon[_ngcontent-%COMP%]{opacity:.8}.t-icon_off[_ngcontent-%COMP%]{color:var(--tui-base-06)}._disabled[_nghost-%COMP%]   .t-icon_off[_ngcontent-%COMP%]{color:var(--tui-base-05)}[data-mode=onDark][_nghost-%COMP%]   .t-icon_off[_ngcontent-%COMP%]{color:var(--tui-text-03-night)}[data-mode=onDark]._disabled[_nghost-%COMP%]   .t-icon_off[_ngcontent-%COMP%]{color:var(--tui-clear-inverse-active)}[data-mode=onLight][_nghost-%COMP%]   .t-icon_off[_ngcontent-%COMP%]{color:var(--tui-text-03)}[data-mode=onLight]._disabled[_nghost-%COMP%]   .t-icon_off[_ngcontent-%COMP%]{color:var(--tui-clear-active)}[data-size=m][_nghost-%COMP%]   .t-icon[_ngcontent-%COMP%]{width:1rem;height:1rem;transform:scale(.75)}[data-size=l][_nghost-%COMP%]   .t-icon[_ngcontent-%COMP%]{margin:0 .125rem;width:1.5rem;height:1.5rem}[_nghost-%COMP%]:hover   .t-icon[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0}),(0,M.gn)([(0,N.TH)()],i.prototype,"singleColor",void 0),(0,M.gn)([(0,N.TH)()],i.prototype,"showIcons",void 0),(0,M.gn)([(0,N.TH)()],i.prototype,"showLoader",void 0),(0,M.gn)([(0,N.TH)()],i.prototype,"size",void 0),i})(),Dt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[d.ez,X.F,K.u,yt,tt.c,H.S,ot.W,C.EI,F.dS,it.wq]]}),i})();var at=a(80311),_=a(75809),q=a(39367);class v{}function Mt(i,o){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",22),t.NdJ("click",function(){const r=t.CHM(e).index,l=t.oxw(2);return t.KtG(l.activeIndex=r)}),t._uU(2),t.qZA(),t.BQk()}if(2&i){const e=o.$implicit;t.xp6(2),t.Oqu(e)}}v.\u0275fac=function(o){return new(o||v)},v.\u0275cmp=t.Xpm({type:v,selectors:[["app-workflow-skeleton"]],standalone:!0,features:[t.jDz],decls:21,vars:0,consts:[[1,"h-3","bg-gray-200","rounded-sm","w-48","mb-4","animate-pulse"],[1,"h-48","bg-gray-200","rounded-md","w-full","mb-4","animate-pulse","px-20","py-6"],[1,"h-2","bg-gray-300","rounded-sm","w-64","mb-4","animate-pulse"],[1,"h-8","bg-gray-300","rounded-sm","w-full","mb-4","animate-pulse"],[1,"h-3","bg-gray-300","rounded-sm","w-48","mb-4","mt-7","animate-pulse"],[1,"flex","flex-col","justify-center","items-center","align-middle"],[1,"h-44","bg-gray-200","rounded-md","w-132","mb-4","animate-pulse","px-12","py-7"],[1,"h-6","bg-gray-300","rounded-full","w-28","mb-4","animate-pulse"],[1,"h-3","bg-gray-300","rounded-sm","w-68","mb-4","animate-pulse"],[1,"h-3","bg-gray-300","rounded-sm","w-48","my-4","animate-pulse"],[1,"flex","justify-between","gap-x-4"],[1,"w-28","h-28","bg-white","border-8","rounded-full","block","border-gray-300"],[1,"h-40","bg-gray-200","rounded-lg","w-full","mb-4","animate-pulse"]],template:function(o,e){1&o&&(t._UZ(0,"div",0),t.TgZ(1,"div",1),t._UZ(2,"div",2)(3,"div",3)(4,"br")(5,"div",2)(6,"div",3),t.qZA(),t._UZ(7,"div",4),t.TgZ(8,"div",5)(9,"div",6),t._UZ(10,"div",7)(11,"div",8)(12,"div",8),t.qZA(),t.TgZ(13,"div",6),t._UZ(14,"div",7)(15,"div",8)(16,"div",8),t.qZA()(),t._UZ(17,"div",9),t.TgZ(18,"div",10),t._UZ(19,"div",11)(20,"div",12),t.qZA())},dependencies:[d.ez],changeDetection:0});const Nt=function(){return{disableAlerts:!0}};function Ft(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",24)(1,"formio",25),t.NdJ("submit",function(s){t.CHM(e);const r=t.oxw(3);return t.KtG(r.updateFormData(s))}),t.qZA()()}if(2&i){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("readOnly",1==n.checkIfAllApproved()||0==n.checkIfLoggedInUserIsPartOfActiveUsers()||0==n.checkIfUserIsInEditUsers())("options",t.DdM(4,Nt))("submission",e)("form",e)}}function Pt(i,o){if(1&i&&(t.ynx(0),t.YNc(1,Ft,2,5,"div",23),t.BQk()),2&i){const e=o.index,n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",n.activeIndex==e)}}function Jt(i,o){1&i&&(t.ynx(0),t.TgZ(1,"tui-badge",29),t._UZ(2,"tui-svg",30),t.qZA(),t._UZ(3,"hr",31),t.BQk()),2&i&&(t.xp6(1),t.Q6J("value","Pending"))}function Qt(i,o){1&i&&(t.ynx(0),t.TgZ(1,"tui-badge",32),t._UZ(2,"tui-svg",33),t.qZA(),t._UZ(3,"hr",31),t.BQk()),2&i&&(t.xp6(1),t.Q6J("value","Active"))}function Lt(i,o){1&i&&(t.ynx(0),t.TgZ(1,"tui-badge",34),t._UZ(2,"tui-svg",35),t.qZA(),t._UZ(3,"hr",31),t.BQk()),2&i&&(t.xp6(1),t.Q6J("value","Rejected"))}function Vt(i,o){1&i&&(t.ynx(0),t.TgZ(1,"tui-badge",36),t._UZ(2,"tui-svg",37),t.qZA(),t._UZ(3,"hr",31),t.BQk()),2&i&&(t.xp6(1),t.Q6J("value","Approved"))}function Et(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",43)(1,"span"),t._uU(2,"Approve \xa0 "),t.TgZ(3,"tui-toggle",44),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit,r=t.oxw(3),l=t.MAs(8);return t.KtG(r.showDialog(s,l))}),t.ALo(4,"async"),t.qZA()(),t.TgZ(5,"span"),t._uU(6,"Reject \xa0 "),t.TgZ(7,"tui-toggle",44),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit,r=t.oxw(3),l=t.MAs(8);return t.KtG(r.showDialog(s,l))}),t.ALo(8,"async"),t.qZA()()()}if(2&i){const e=t.oxw(4);t.xp6(3),t.Q6J("showIcons",!0)("showLoader",t.lcZ(4,6,e.showLoader))("formControl",e.approve),t.xp6(4),t.Q6J("showIcons",!0)("showLoader",t.lcZ(8,8,e.showLoader))("formControl",e.reject)}}function Wt(i,o){if(1&i&&(t.TgZ(0,"p",45),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).$implicit;t.xp6(1),t.Oqu(null==e?null:e.condition)}}function qt(i,o){if(1&i&&(t.ynx(0),t.TgZ(1,"li",38)(2,"div",39)(3,"span",40),t._uU(4),t.qZA(),t.YNc(5,Et,9,10,"div",41),t.qZA()(),t.YNc(6,Wt,2,1,"p",42),t.BQk()),2&i){const e=o.$implicit,n=o.last,s=t.oxw().$implicit,r=t.oxw(2);t.xp6(4),t.Oqu(null==e?null:e.name),t.xp6(1),t.Q6J("ngIf",(null==r.currentUser?null:r.currentUser.fullName)===(null==e?null:e.name)&&1==r.checkIfUserisStillActive(null==r.currentUser?null:r.currentUser.fullName)&&0==r.checkIfUserRejected()&&0==r.userApprovedCheckResult()&&"inProgress"==(null==s?null:s.status)),t.xp6(1),t.Q6J("ngIf",!n)}}function Yt(i,o){1&i&&t._UZ(0,"i",46)}function Bt(i,o){if(1&i&&(t.ynx(0),t.TgZ(1,"tui-island",26),t.YNc(2,Jt,4,1,"ng-container",21),t.YNc(3,Qt,4,1,"ng-container",21),t.YNc(4,Lt,4,1,"ng-container",21),t.YNc(5,Vt,4,1,"ng-container",21),t.TgZ(6,"ul",27),t.YNc(7,qt,7,3,"ng-container",8),t.qZA()(),t.YNc(8,Yt,1,0,"i",28),t.BQk()),2&i){const e=o.$implicit,n=o.last;t.xp6(1),t.Q6J("hoverable",!0)("ngClass","approved"==(null==e?null:e.status)?"border border-green-600":"rejected"==(null==e?null:e.status)?"border border-red-600":"inProgress"==(null==e?null:e.status)?"border border-blue-600":"border border-yellow-600"),t.xp6(1),t.Q6J("ngIf","pending"==(null==e?null:e.status)),t.xp6(1),t.Q6J("ngIf","inProgress"==(null==e?null:e.status)),t.xp6(1),t.Q6J("ngIf","rejected"==(null==e?null:e.status)),t.xp6(1),t.Q6J("ngIf","approved"==(null==e?null:e.status)),t.xp6(2),t.Q6J("ngForOf",null==e?null:e.approverIds),t.xp6(1),t.Q6J("ngIf",!n)}}function jt(i,o){1&i&&(t.ynx(0),t.TgZ(1,"p",47),t._uU(2,"Approval logs are empty!"),t.qZA(),t.BQk())}function zt(i,o){if(1&i&&(t.ynx(0),t.TgZ(1,"div",48)(2,"p",49),t._uU(3,"Performed by: \xa0 "),t.TgZ(4,"span",50),t._uU(5),t.qZA()(),t.TgZ(6,"p",49),t._uU(7,"Decision: \xa0 "),t.TgZ(8,"span",51),t._uU(9),t.qZA()(),t.TgZ(10,"p",52),t._uU(11," Approved On: "),t.TgZ(12,"span",50),t._uU(13),t.ALo(14,"date"),t.qZA()(),t.TgZ(15,"p",52),t._uU(16,"Comments: "),t.TgZ(17,"span",50),t._uU(18),t.qZA()()(),t.BQk()),2&i){const e=o.$implicit;t.xp6(4),t.Q6J("ngClass","approved"==(null==e?null:e.approvalStatus)?"text-green-500":"text-red-500"),t.xp6(1),t.Oqu(null==e||null==e.performedById?null:e.performedById.fullName),t.xp6(3),t.Q6J("ngClass","approved"==(null==e?null:e.approvalStatus)?"text-green-500":"text-red-500"),t.xp6(1),t.Oqu(null==e?null:e.approvalStatus),t.xp6(3),t.Q6J("ngClass","approved"==(null==e?null:e.approvalStatus)?"text-green-500":"text-red-500"),t.xp6(1),t.hij("\xa0",t.xi3(14,8,null==e?null:e.approvedOn,"medium"),""),t.xp6(4),t.Q6J("ngClass","approved"==(null==e?null:e.approvalStatus)?"text-green-500":"text-red-500"),t.xp6(1),t.hij("\xa0",null==e?null:e.remarks,"")}}function Rt(i,o){if(1&i&&(t.ynx(0),t.TgZ(1,"p",4),t._uU(2,"Forms"),t.qZA(),t.TgZ(3,"div",5)(4,"section",6)(5,"nav",7),t.YNc(6,Mt,3,1,"ng-container",8),t.qZA(),t.YNc(7,Pt,2,1,"ng-container",8),t.qZA()(),t.TgZ(8,"section",9)(9,"p",10),t._uU(10,"Approval Workflow"),t.qZA(),t.TgZ(11,"div",11),t.YNc(12,Bt,9,8,"ng-container",8),t.qZA()(),t.TgZ(13,"section",12)(14,"p",10),t._uU(15,"Workflow Progress & Approval Logs"),t.qZA(),t.TgZ(16,"div",13)(17,"div",14)(18,"label",15)(19,"span",16),t._uU(20,"COMPLETED"),t.qZA(),t.TgZ(21,"span",17),t._uU(22),t.ALo(23,"number"),t.ALo(24,"async"),t.qZA(),t._UZ(25,"tui-progress-circle",18),t.ALo(26,"async"),t.ALo(27,"async"),t.qZA()(),t.TgZ(28,"div",19)(29,"tui-island",20),t.YNc(30,jt,3,0,"ng-container",21),t.YNc(31,zt,19,11,"ng-container",8),t.qZA()()()(),t.BQk()),2&i){const e=t.oxw();t.xp6(6),t.Q6J("ngForOf",e.formTabs),t.xp6(1),t.Q6J("ngForOf",e.formWithWorkflow),t.xp6(5),t.Q6J("ngForOf",e.workflowUsers),t.xp6(10),t.hij("",t.xi3(23,9,t.lcZ(24,12,e.workflowProgress),"1.2-2"),"%"),t.xp6(3),t.Q6J("max",e.max)("value",t.lcZ(26,14,e.workflowProgress))("color",e.changeProgressColor(t.lcZ(27,16,e.workflowProgress))),t.xp6(5),t.Q6J("ngIf",0==(null==e.approvalLogs?null:e.approvalLogs.length)),t.xp6(1),t.Q6J("ngForOf",e.approvalLogs)}}function $t(i,o){1&i&&t._UZ(0,"app-workflow-skeleton")}function Gt(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"p",53),t._uU(1,"You have chosen to "),t.TgZ(2,"span",54),t._uU(3),t.qZA(),t._uU(4," this step. "),t.qZA(),t.TgZ(5,"p",55),t._uU(6,"Please add your comments below (if any) and send your decision"),t.qZA(),t.TgZ(7,"div",56)(8,"label",57),t._uU(9,"Comments"),t.qZA(),t._UZ(10,"textarea",58),t.qZA(),t.TgZ(11,"div",59)(12,"button",60),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.sendDecisionData())}),t.ALo(13,"async"),t._uU(14," Send "),t.qZA(),t.TgZ(15,"button",61),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw().cancelDecision(),t.KtG(r.complete())}),t._uU(16," Cancel "),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(2),t.Q6J("ngClass",1==(null==e.approve?null:e.approve.value)?"text-green-500":"text-red-500"),t.xp6(1),t.Oqu(1==(null==e.approve?null:e.approve.value)?"Approve":"Reject"),t.xp6(7),t.Q6J("formControl",e.remarks),t.xp6(2),t.Q6J("showLoader",t.lcZ(13,4,e.savingDecision))}}class T{constructor(o,e,n,s){this.dialogs=o,this.activatedRoute=e,this.workflowService=n,this.auth=s,this.max=100,this.value$=(0,ht.of)(25),this.destroy$=new g.x,this.activeIndex=0,this.workflowUsers=[],this.approvalLogs=[],this.approve=new u.NI(!1),this.reject=new u.NI(!1),this.remarks=new u.NI(""),this.showLoader=new g.x,this.formTabs=[],this.workflowProgress=new S.X(0),this.saveDialogSubscription=[],this.decisionData=new S.X(null),this.savingDecision=new g.x,this.approvedUsers=[],this.activeUsers=[],this.formAllowedForEditUsers=[],this.loadingData=new g.x,this.currentUser=this.auth.currentUserValue,this.fetchData(),this.approve.valueChanges.pipe((0,c.R)(this.destroy$)).subscribe(r=>{!0===r&&(this.reject.disable(),this.showLoader.next(!0),setTimeout(()=>this.showLoader.next(!1),1e3)),!1===r&&this.reject.disabled&&this.reject.enable()}),this.reject.valueChanges.pipe((0,c.R)(this.destroy$)).subscribe(r=>{!0===r&&(this.approve.disable(),this.showLoader.next(!0),setTimeout(()=>this.showLoader.next(!1),1e3)),!1===r&&this.approve.disabled&&this.approve.enable()})}fetchData(){this.loadingData.next(!0),this.activatedRoute.params.pipe((0,G.j)("id"),(0,w.U)(o=>this.workflowID=o),(0,J.w)(o=>this.workflowService.getWorkflowSubmission(o))).subscribe(o=>{o&&(this.workflowData=o,this.formAllowedForEditUsers=this.workflowData?.workflowStatus?.map(e=>({users:e?.activeUsers?.map(n=>n?.fullName),status:e?.status})),this.approvedUsers=this.workflowData?.workflowStatus?.map(e=>({users:e?.approvedUsers?.map(n=>n?.fullName),status:e?.status})),this.lastApprovalCheck={status:this.workflowData?.approvalLog.at(-1)?.approvalStatus,user:this.workflowData?.approvalLog.at(-1)?.performedById?.fullName},this.formTabs=this.workflowData?.formIds?.map(e=>e.title),this.formWithWorkflow=this.workflowData?.formIds?.map(e=>({...e,formDataId:this.workflowData?.formDataIds?.map(n=>{if(n.formId==e?._id)return n?._id}).filter(n=>n)[0],data:this.workflowData?.formDataIds?.map(n=>{if(n.formId==e?._id)return n?.data}).filter(n=>n)[0]})),this.activeUsers=this.workflowData?.workflowStatus?.flatMap(e=>e?.activeUsers)?.map(e=>e?.fullName),this.workflowUsers=this.workflowData?.workflowStatus?.map(e=>({approverIds:e?.allUsers?.map(n=>({name:n?.fullName,id:n?._id,stepId:e?.stepId})),condition:e?.condition,status:e?.status})),this.workflowProgress.next(this.workflowData?.summaryData?.progress),this.approvalLogs=this.workflowData?.approvalLog,this.allApproved=this.workflowData?.workflowStatus?.map(e=>"approved"==e?.status),this.loadingData.next(!1))})}showDialog(o,e){this.showLoader.pipe((0,c.R)(this.destroy$)).subscribe(n=>{!1===n&&(this.decisionData.next(o),this.saveDialogSubscription.push(this.dialogs.open(e,{dismissible:!1,closeable:!1}).pipe((0,_t.q)(1)).subscribe()))})}sendDecisionData(){this.savingDecision.next(!0),this.workflowService.updateSubmissionWorkflow(this.workflowID,{stepId:this.decisionData?.value?.stepId,userId:this.currentUser?.id,remarks:this.remarks?.value,isApproved:1==this.approve?.value}).pipe((0,c.R)(this.destroy$)).subscribe(e=>{e?(this.fetchData(),this.savingDecision.next(!1),this.remarks.reset(),this.saveDialogSubscription.forEach(n=>n.unsubscribe()),this.reject.reset(),this.approve.reset(),this.reject.enable(),this.approve.enable()):this.savingDecision.next(!1)})}cancelDecision(){this.remarks.reset(),this.saveDialogSubscription.forEach(o=>o.unsubscribe()),this.reject.reset(),this.approve.reset(),this.reject.enable(),this.approve.enable()}changeProgressColor(o){return o<=49?"#F15B41":o>49&&o<75?"#F9B71A":o>=75?"#32de84":"#fff"}checkIfUserCanEditForm(){return this.formAllowedForEditUsers?.map(o=>!(!o.users?.includes(this.currentUser?.fullName)||"inProgress"!=o.status))}checkIfUserIsInEditUsers(){return this.checkIfUserCanEditForm().includes(!0)}checkIfUserIsApproved(o){return this.approvedUsers?.map(e=>!(!e.users?.includes(o)||"inProgress"!=e.status))}userApprovedCheckResult(){return this.checkIfUserIsApproved(this.currentUser?.fullName).includes(!0)}checkIfUserisStillActive(o){return this.activeUsers.includes(o)}checkIfUserRejected(){return"rejected"==this.lastApprovalCheck?.status&&this.currentUser?.fullName==this.lastApprovalCheck?.user}checkIfLoggedInUserIsPartOfActiveUsers(){return this.activeUsers.includes(this.currentUser?.fullName)}checkIfAllApproved(){return!this.allApproved.includes(!1)}updateFormData(o){this.workflowService.updateFormsData({formId:o?._id,data:o?.data},o?.formDataId).pipe((0,c.R)(this.destroy$)).subscribe(n=>{n&&this.fetchData()})}ngOnDestroy(){this.destroy$.complete(),this.destroy$.unsubscribe()}}T.\u0275fac=function(o){return new(o||T)(t.Y36($.RO),t.Y36(m.gz),t.Y36(f),t.Y36(L.e))},T.\u0275cmp=t.Xpm({type:T,selectors:[["ng-component"]],decls:9,vars:4,consts:[[1,"w-11/12","h-auto","min-h-screen","mx-auto","mt-52","pb-44"],[4,"ngIf","ngIfElse"],["showSkeleton",""],["template",""],[1,"text-lg","font-semibold"],[1,"flex","flex-col","w-full","px-5","mx-auto","mt-5","border","border-gray-400","border-dashed","rounded-md","bg-gray-50"],[1,"flex","justify-between","my-8"],["tuiTabs","","vertical","left",1,"w-32","mr-5"],[4,"ngFor","ngForOf"],[1,"my-10"],[1,"mb-5","text-lg","font-semibold"],[1,"flex","flex-col","items-center","justify-center"],[1,"my-4"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-2"],["tuiProgressLabel",""],[1,"font-semibold","text-gray-600"],[1,"font-semibold","text-gray-700"],["size","xl",3,"max","value","color"],[1,"col-span-10"],["size","l",1,"w-full","shadow-lg"],[4,"ngIf"],["tuiTab","",3,"click"],["class","w-full well jsonviewer",4,"ngIf"],[1,"w-full","well","jsonviewer"],[3,"readOnly","options","submission","form","submit"],["size","l",1,"w-1/2","my-4","shadow-lg",3,"hoverable","ngClass"],[1,"tui-list"],["class","fa fa-long-arrow-down fa-2x","aria-hidden","true",4,"ngIf"],["status","custom",1,"px-2","font-semibold","text-white","bg-yellow-600","tui-space_right-2","tui-space_bottom-4",3,"value"],["src","tuiIconClock"],[1,"mb-2"],["status","custom",1,"px-2","font-semibold","text-white","bg-blue-600","tui-space_right-2","tui-space_bottom-4",3,"value"],["src","tuiIconRadio"],["status","custom",1,"px-2","font-semibold","text-white","bg-red-600","tui-space_right-2","tui-space_bottom-4",3,"value"],["src","tuiIconAlertOctagon"],["status","custom",1,"px-2","font-semibold","text-white","bg-green-600","tui-space_right-2","tui-space_bottom-4",3,"value"],["src","tuiIconCheckCircle"],[1,"tui-list__item"],[1,"flex","justify-between"],[1,"text-base","font-semibold"],["class","flex justify-end gap-5",4,"ngIf"],["class","mt-2 ml-8 font-normal",4,"ngIf"],[1,"flex","justify-end","gap-5"],["size","l",3,"showIcons","showLoader","formControl","click"],[1,"mt-2","ml-8","font-normal"],["aria-hidden","true",1,"fa","fa-long-arrow-down","fa-2x"],[1,"py-5","text-base","font-semibold","text-center","text-gray-500"],[1,"grid","grid-cols-12","py-3","gap-x-3","border-b","border-gray-300"],[1,"col-span-2","font-normal"],[1,"font-semibold",3,"ngClass"],[1,"font-semibold","capitalize",3,"ngClass"],[1,"col-span-4","font-normal"],[1,"text-lg","font-semibold","text-center"],[1,"mx-1","text-lg","font-semibold",3,"ngClass"],[1,"mt-3","text-base","font-medium"],[1,"flex","flex-col","justify-center","my-5"],["for","Textarea1",1,"block"],["id","Textarea1","rows","4",1,"form-control",3,"formControl"],[1,"flex","justify-start","gap-x-3"],["tuiButton","","type","button","size","m",3,"showLoader","click"],["tuiButton","","type","button","appearance","accent","size","m",3,"click"]],template:function(o,e){if(1&o&&(t._UZ(0,"app-header"),t.TgZ(1,"section",0),t.YNc(2,Rt,32,18,"ng-container",1),t.ALo(3,"async"),t.YNc(4,$t,1,0,"ng-template",null,2,t.W1O),t.qZA(),t._UZ(6,"app-footer"),t.YNc(7,Gt,17,6,"ng-template",null,3,t.W1O)),2&o){const n=t.MAs(5);t.xp6(2),t.Q6J("ngIf",0==t.lcZ(3,2,e.loadingData))("ngIfElse",n)}},dependencies:[d.mk,d.sg,d.O5,O.G,V.c,E.k4,D.BY,D.vV,W.h,u.Fj,u.JJ,u.oH,Ot,at.g,C.PN,q.v0,_.p_,_.uW,_.yu,v,d.Ov,d.JJ,d.uU]});var Y=a(46954),B=a(82176),lt=a(55314),ut=a(6110);const Ht=function(i){return["/submodule/submissions/add-submission",i]};function Kt(i,o){if(1&i&&(t.TgZ(0,"div",18)(1,"a",19),t._uU(2,"+ Add submission"),t.qZA()()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("routerLink",t.VKq(1,Ht,e.submoduleId))}}function Xt(i,o){1&i&&(t.ynx(0),t.TgZ(1,"th",20),t._uU(2," It seems there is no data to show here! "),t.qZA(),t.BQk())}function te(i,o){1&i&&(t.TgZ(0,"span"),t._uU(1,","),t.qZA())}function ee(i,o){if(1&i&&(t.ynx(0),t.TgZ(1,"span"),t._uU(2),t.YNc(3,te,2,0,"span",30),t._uU(4," \xa0"),t.qZA(),t.BQk()),2&i){const e=o.$implicit,n=o.last;t.xp6(2),t.Oqu(e),t.xp6(1),t.Q6J("ngIf",!n)}}const oe=function(i){return["/submodule/submissions/view-workflow",i]};function ie(i,o){if(1&i&&(t.TgZ(0,"a",31),t._UZ(1,"i",32),t._uU(2," View "),t.qZA()),2&i){const e=t.oxw().$implicit;t.Q6J("routerLink",t.VKq(1,oe,null==e?null:e.id))}}const ne=function(){return[]};function se(i,o){if(1&i&&(t.ynx(0),t.TgZ(1,"tr",22)(2,"td",23),t._uU(3),t.qZA(),t.TgZ(4,"td",24),t._uU(5),t.qZA(),t.TgZ(6,"td",24),t.YNc(7,ee,5,2,"ng-container",25),t.qZA(),t.TgZ(8,"td",26),t._UZ(9,"progress",27),t.TgZ(10,"span"),t._uU(11),t.ALo(12,"number"),t.qZA()(),t.TgZ(13,"td",28),t.YNc(14,ie,3,3,"a",29),t.qZA()(),t.BQk()),2&i){const e=o.$implicit,n=t.oxw(3);t.xp6(3),t.hij(" ",n.showStatus(null==e?null:e.submissionStatus)," "),t.xp6(2),t.hij(" ",(null==e||null==e.summaryData?null:e.summaryData.userName)||""," "),t.xp6(2),t.Q6J("ngForOf",n.getPendingOnUsers((null==e||null==e.summaryData?null:e.summaryData.pendingOnUsers)||t.DdM(10,ne))),t.xp6(2),t.Q6J("color",n.changeProgressColor(null==e||null==e.summaryData?null:e.summaryData.progress))("value",null==e||null==e.summaryData?null:e.summaryData.progress),t.xp6(2),t.hij("",t.xi3(12,7,null==e||null==e.summaryData?null:e.summaryData.progress,"1.1-2")," %"),t.xp6(3),t.Q6J("ngIf",1==n.checkIfUserisPartofWorkflow(null==e?null:e.workflowAllUsers)||"admin"==(null==n.currentUser?null:n.currentUser.role)||(null==e?null:e.createdBy)==(null==n.currentUser?null:n.currentUser.id))}}function re(i,o){if(1&i&&t.YNc(0,se,15,11,"ng-container",21),2&i){const e=t.oxw(2);t.Q6J("ngForOf",e.tableDataValue)("ngForTrackBy",e.trackByFn)}}function ae(i,o){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"p",3),t._uU(2,"Code:\xa0 "),t.TgZ(3,"span",4),t._uU(4),t.qZA()(),t.TgZ(5,"div",5)(6,"p",6),t._uU(7,"List of Submissions"),t.qZA(),t.YNc(8,Kt,3,3,"div",7),t.qZA(),t.TgZ(9,"div",8)(10,"table",9)(11,"thead",10)(12,"tr")(13,"th",11),t._uU(14," Submission Status\xa0 "),t.TgZ(15,"filter",12),t.NdJ("applyStatus",function(s){t.CHM(e);const r=t.oxw();return t.KtG(r.sendFilterValue(s))})("resetFilters",function(s){t.CHM(e);const r=t.oxw();return t.KtG(r.resetFilterValues(s))}),t.qZA()(),t.TgZ(16,"th",13),t._uU(17,"Last Activity By"),t.qZA(),t.TgZ(18,"th",13),t._uU(19,"Now Pending With"),t.qZA(),t.TgZ(20,"th",13),t._uU(21,"Workflow progress"),t.qZA(),t.TgZ(22,"th",14),t._uU(23," Actions "),t.qZA()()(),t.TgZ(24,"tbody"),t.YNc(25,Xt,3,0,"ng-container",1),t.YNc(26,re,1,2,"ng-template",null,15,t.W1O),t.qZA()(),t.TgZ(28,"div",16)(29,"tui-pagination",17),t.NdJ("indexChange",function(s){t.CHM(e);const r=t.oxw();return t.KtG(r.goToPage(s))}),t.qZA()()(),t.BQk()}if(2&i){const e=o.ngIf,n=t.MAs(27),s=t.oxw();t.xp6(4),t.Oqu(null==s.submoduleData?null:s.submoduleData.code),t.xp6(4),t.Q6J("ngIf",s.checkIfUserisAdmin()||(null==s.submoduleData?null:s.submoduleData.createdBy)==(null==s.currentUser?null:s.currentUser.id)||"admin"==(null==s.currentUser?null:s.currentUser.role)),t.xp6(7),t.Q6J("filterBy","Status")("items",s.statusMenu)("searchEnabled",!1),t.xp6(10),t.Q6J("ngIf",0==(null==s.tableDataValue?null:s.tableDataValue.length))("ngIfElse",n),t.xp6(4),t.Q6J("length",(null==e?null:e.totalPages)||1)("index",(null==e?null:e.page)-1||0)}}function le(i,o){1&i&&t._UZ(0,"app-table-loader")}class Z{constructor(o,e,n,s){this.activatedRoute=o,this.workflowService=e,this.auth=n,this.dashboard=s,this.subscriptions=[],this.adminUsers=[],this.createdByUsers=[],this.destroy$=new g.x,this.filterMenuCompany=[{name:"Sort by Acsending",status:"idle",icon:"fa fa-sort-alpha-asc fa-lg"},{name:"Sort by Decsending",status:"idle",icon:"fa fa-sort-alpha-desc fa-lg"},{name:"Sort by Latest",status:"idle",icon:"fa fa-calendar-check-o fa-lg"},{name:"Sort by Oldest",status:"idle",icon:"fa fa-calendar-times-o fa-lg"}],this.statusMenu=[{name:"Created",status:"idle",icon:""},{name:"Completed",status:"idle",icon:""},{name:"In Progress",status:"idle",icon:""},{name:"Draft",status:"idle",icon:""}],this.page=1,this.limit=7,this.currentUser=this.auth.currentUserValue,this.subscriptions.push(this.activatedRoute.params.subscribe(r=>{this.submoduleId=r.id,(0,U.LS)(U.MX.workflowID,r.id)})),this.subscriptions.push(this.dashboard.getSubModuleByID(this.submoduleId).subscribe(r=>{this.submoduleData=r})),this.subscriptions.push(this.workflowService.getSubmissionFromSubModule(this.submoduleId,this.limit,this.page).subscribe(r=>{this.submissionData=r,this.tableDataValue=r?.results,this.adminUsers=r?.results?.flatMap(l=>l?.subModuleId?.adminUsers),this.createdByUsers=r?.results?.map(l=>l?.subModuleId?.createdBy)}))}changeProgressColor(o){return o<=49?"#F15B41":o>49&&o<75?"#F9B71A":o>=75?"#32de84":"#fff"}showStatus(o){return 1===o?"Created":3===o?"Completed":2===o?"In Progress":4===o?"Draft":"Rejected"}checkIfUserisAdmin(){return this.adminUsers?.includes(this.currentUser?.id)}checkIfUserisPartofWorkflow(o){return o?.map(e=>e?._id)?.includes(this.currentUser?.id)}checkIfUserisCreator(){return this.createdByUsers?.includes(this.currentUser?.id)}getPendingOnUsers(o){return o?.map(e=>e?.fullName)}sendFilterValue(o){switch(o?.sortType){case"Created":this.workflowService.getSubmissionFromSubModule(this.submoduleId,this.limit,this.page,1).pipe((0,c.R)(this.destroy$)).subscribe(e=>{this.submissionData=e,this.tableDataValue=e?.results});break;case"Completed":this.workflowService.getSubmissionFromSubModule(this.submoduleId,this.limit,this.page,3).pipe((0,c.R)(this.destroy$)).subscribe(e=>{this.submissionData=e,this.tableDataValue=e?.results});break;case"In Progress":this.workflowService.getSubmissionFromSubModule(this.submoduleId,this.limit,this.page,2).pipe((0,c.R)(this.destroy$)).subscribe(e=>{this.submissionData=e,this.tableDataValue=e?.results});break;case"Draft":this.workflowService.getSubmissionFromSubModule(this.submoduleId,this.limit,this.page,4).pipe((0,c.R)(this.destroy$)).subscribe(e=>{this.submissionData=e,this.tableDataValue=e?.results});break;case"Sort by Latest":this.workflowService.getSubmissionFromSubModule(this.submoduleId,this.limit,this.page,void 0,"latest").pipe((0,c.R)(this.destroy$)).subscribe(e=>{this.submissionData=e,this.tableDataValue=e?.results});break;case"Sort by Oldest":this.workflowService.getSubmissionFromSubModule(this.submoduleId,this.limit,this.page,void 0,"oldest").pipe((0,c.R)(this.destroy$)).subscribe(e=>{this.submissionData=e,this.tableDataValue=e?.results})}}resetFilterValues(o){o&&this.workflowService.getSubmissionFromSubModule(this.submoduleId,this.limit,this.page).pipe((0,c.R)(this.destroy$)).subscribe(e=>{this.submissionData=e,this.tableDataValue=e?.results})}trackByFn(o,e){return e?.id}goToPage(o){this.page=o+1,this.workflowService.getSubmissionFromSubModule(this.submoduleId,this.limit,this.page).pipe((0,c.R)(this.destroy$)).subscribe(e=>{this.submissionData=e,this.tableDataValue=e?.results})}ngOnDestroy(){this.subscriptions.forEach(o=>o.unsubscribe())}}Z.\u0275fac=function(o){return new(o||Z)(t.Y36(m.gz),t.Y36(f),t.Y36(L.e),t.Y36(Y.s))},Z.\u0275cmp=t.Xpm({type:Z,selectors:[["ng-component"]],decls:6,vars:2,consts:[[1,"w-11/12","h-auto","min-h-screen","mx-auto","mt-52"],[4,"ngIf","ngIfElse"],["noData",""],[1,"text-left","font-semibold","text-base","mb-7"],[1,"text-[#374151]"],[1,"flex","justify-between","mb-5"],[1,"text-left","font-semibold","text-lg"],["class","cursor-pointer",4,"ngIf"],[1,"relative","overflow-x-auto","rounded-lg","shadow-lg"],[1,"w-full","text-sm","text-left","text-gray-500"],[1,"text-xs","text-gray-700","uppercase","bg-[#eae4d8]"],[1,"px-4","py-3","text-sm"],[3,"filterBy","items","searchEnabled","applyStatus","resetFilters"],[1,"px-2","py-3","text-sm"],["scope","col",1,"px-6","py-3","text-sm"],["showSubmissions",""],[1,"pt-10","pb-6"],[3,"length","index","indexChange"],[1,"cursor-pointer"],[1,"px-6","py-3","rounded-md","bg-[#a58f81]","text-white","no-underline","hover:text-white","text-base",3,"routerLink"],["colspan","12","role","row",1,"px-5","py-10","text-lg","text-center"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"bg-white","border-b","border-gray-300"],[1,"px-4","py-4"],[1,"px-2","py-4"],[4,"ngFor","ngForOf"],[1,"flex","justify-between","px-2","py-4"],["tuiProgressBar","","max","100","size","s",1,"w-9/12","mt-1.5",3,"color","value"],[1,"px-6","py-4"],["class","px-2 py-1 ml-2 text-xs font-medium text-white no-underline bg-green-400 rounded-md cursor-pointer hover:text-white",3,"routerLink",4,"ngIf"],[4,"ngIf"],[1,"px-2","py-1","ml-2","text-xs","font-medium","text-white","no-underline","bg-green-400","rounded-md","cursor-pointer","hover:text-white",3,"routerLink"],["aria-hidden","true",1,"fa","fa-eye","fa-lg"]],template:function(o,e){if(1&o&&(t._UZ(0,"app-header"),t.TgZ(1,"section",0),t.YNc(2,ae,30,9,"ng-container",1),t.YNc(3,le,1,0,"ng-template",null,2,t.W1O),t.qZA(),t._UZ(5,"app-footer")),2&o){const n=t.MAs(4);t.xp6(2),t.Q6J("ngIf",e.submissionData)("ngIfElse",n)}},dependencies:[d.sg,d.O5,m.rH,O.G,V.c,D.iv,B.r,lt.X,ut.z,d.JJ]});var j=a(39062),ct=a(4053),dt=a(56772),pt=a(37378),ue=a(53861),mt=a(71115),gt=a(13675),ce=a(82210),ft=a(77915);function de(i,o){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",16),t.NdJ("click",function(){const r=t.CHM(e).index,l=t.oxw();return t.KtG(l.activeIndex=r)}),t._uU(2),t.qZA(),t.BQk()}if(2&i){const e=o.$implicit;t.xp6(2),t.Oqu(e)}}function pe(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",18)(1,"formio",19),t.NdJ("change",function(s){t.CHM(e);const r=t.oxw().index,l=t.oxw();return t.KtG(l.onChange(s,r))}),t.qZA()()}if(2&i){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.Q6J("submission",n.formValues[n.activeIndex])("options",n.options)("form",e)}}function me(i,o){if(1&i&&(t.ynx(0),t.YNc(1,pe,2,3,"div",17),t.BQk()),2&i){const e=o.index,n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.activeIndex==e)}}function ge(i,o){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"p",24),t._uU(2),t.qZA(),t.TgZ(3,"div",25)(4,"div",26)(5,"label",27),t._uU(6,"Approvers "),t.TgZ(7,"span",28),t._uU(8,"*"),t.qZA()(),t.TgZ(9,"custom-multi-select",29),t.NdJ("checkUsersLength",function(s){const l=t.CHM(e).index,p=t.oxw(2);return t.KtG(p.countUsers(s,l))})("approverList",function(s){const l=t.CHM(e).index,p=t.oxw(2);return t.KtG(p.getApproverList(s,l))}),t.qZA()(),t.TgZ(10,"div",26)(11,"label",30),t._uU(12,"Condition "),t.TgZ(13,"span",28),t._uU(14,"*"),t.qZA()(),t.TgZ(15,"select",31),t.NdJ("change",function(){const r=t.CHM(e).index,l=t.oxw(2);return t.KtG(l.validateSelection(r))}),t.TgZ(16,"option",32),t._uU(17,"AND"),t.qZA(),t.TgZ(18,"option",33),t._uU(19,"OR"),t.qZA(),t.TgZ(20,"option",34),t._uU(21,"NONE"),t.qZA()()(),t.TgZ(22,"div",35),t._UZ(23,"tui-tooltip",36),t.TgZ(24,"tui-badged-content",37)(25,"button",38),t.NdJ("click",function(){const r=t.CHM(e).index,l=t.oxw(2),p=t.MAs(23);return t.KtG(l.openEmailNotifyModal(p,l.workflows,r))}),t.qZA()()(),t.TgZ(26,"div",39)(27,"button",40),t.NdJ("click",function(){const r=t.CHM(e).index,l=t.oxw(2);return t.KtG(l.removeWorkflowStep(r))}),t.qZA()()(),t.BQk()}if(2&i){const e=o.index,n=t.oxw(2),s=t.MAs(25);let r;t.xp6(2),t.hij("Step ",0===e?"1":e+1,""),t.xp6(1),t.Q6J("formGroupName",e),t.xp6(20),t.Q6J("content",s),t.xp6(1),t.Q6J("contentTop",null==(r=n.workflows.at(e).get("emailNotifyTo"))||null==r.value?null:r.value.length)("colorTop","green")}}function fe(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",20)(1,"h4",21),t._uU(2,"Modify submodule workflow"),t.qZA(),t.ynx(3,22),t.YNc(4,ge,28,5,"ng-container",4),t.BQk(),t.TgZ(5,"button",23),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.addWorkflowStep())}),t.qZA()()}if(2&i){const e=t.oxw();t.Q6J("formGroup",e.workflowForm),t.xp6(4),t.Q6J("ngForOf",e.workflows.controls)}}function he(i,o){if(1&i&&(t.TgZ(0,"ul",53)(1,"li",54),t._uU(2),t.qZA()()),2&i){const e=o.$implicit;t.xp6(2),t.Oqu(e)}}function _e(i,o){1&i&&t._UZ(0,"i",55)}function be(i,o){if(1&i&&(t.TgZ(0,"div",46)(1,"div",47)(2,"p",48),t._uU(3),t.qZA(),t.YNc(4,he,3,1,"ul",49),t.TgZ(5,"div",50),t._uU(6),t.qZA()(),t.TgZ(7,"div",51),t.YNc(8,_e,1,0,"i",52),t.qZA()()),2&i){const e=t.oxw(),n=e.index,s=e.$implicit,r=e.last;t.xp6(3),t.hij("Step ",n+1,""),t.xp6(1),t.Q6J("ngForOf",null==s?null:s.approvers),t.xp6(2),t.hij(" ",null==s?null:s.condition," "),t.xp6(2),t.Q6J("ngIf",!r)}}function we(i,o){1&i&&(t.ynx(0),t.YNc(1,be,9,4,"div",45),t.BQk())}function ve(i,o){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"tui-island",41)(2,"h4",42),t._uU(3,"Workflow Steps"),t.qZA(),t.TgZ(4,"tui-carousel",43),t.NdJ("indexChange",function(s){t.CHM(e);const r=t.oxw();return t.KtG(r.carouselIndex=s)}),t.YNc(5,we,2,0,"ng-container",4),t.qZA(),t.TgZ(6,"tui-pagination",44),t.NdJ("indexChange",function(s){t.CHM(e);const r=t.oxw();return t.KtG(r.carouselIndex=s)}),t.qZA()(),t.BQk()}if(2&i){const e=t.oxw();t.xp6(4),t.Q6J("draggable",!0)("itemsCount",3)("index",e.carouselIndex),t.xp6(1),t.Q6J("ngForOf",e.items),t.xp6(1),t.Q6J("length",(null==e.items?null:e.items.length)>2?(null==e.items?null:e.items.length)-2:null==e.items?null:e.items.length)("index",e.carouselIndex)}}function xe(i,o){if(1&i&&t._UZ(0,"tui-data-list-wrapper",64),2&i){const e=t.oxw(2);t.Q6J("items",e.userListForEmail)}}function ye(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"p",56),t._uU(1,"Email Notification Users"),t.qZA(),t.TgZ(2,"p",57),t._uU(3," Please specify the users you want to send the notification email to "),t.qZA(),t.TgZ(4,"div",58)(5,"tui-input-tag",59),t.NdJ("searchChange",function(s){t.CHM(e);const r=t.oxw();return t.KtG(r.onSearchChange(s))}),t._uU(6," Type to search and press Enter to select... "),t.YNc(7,xe,1,1,"tui-data-list-wrapper",60),t.qZA()(),t.TgZ(8,"div",61)(9,"button",62),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.validateEmails())}),t._uU(10," Confirm & Close "),t.qZA(),t.TgZ(11,"button",63),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.cancelEmailNotify())}),t._uU(12," Remove Users & Close "),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(5),t.Q6J("formControl",null==e.currentFieldArray||null==e.currentFieldArray.controls[e.activeEmailIndex]?null:e.currentFieldArray.controls[e.activeEmailIndex].controls.emailNotifyTo)("tuiTextfieldLabelOutside",!0)}}function ke(i,o){1&i&&(t.TgZ(0,"strong",65),t._uU(1,"How conditions work?"),t.qZA(),t._UZ(2,"hr"),t.TgZ(3,"ul",66)(4,"li")(5,"strong"),t._uU(6,"AND"),t.qZA(),t._uU(7," implies that every user of the step must provide approval"),t.qZA(),t.TgZ(8,"li",67)(9,"strong"),t._uU(10,"OR"),t.qZA(),t._uU(11," implies that any one of the users may provide approval"),t.qZA(),t.TgZ(12,"li")(13,"strong"),t._uU(14,"NONE"),t.qZA(),t._uU(15," implies that there is only one user per step and hence no conditon is necessary"),t.qZA()())}class I{constructor(o,e,n,s,r,l,p,Ie,Ae){this.fb=o,this.notif=e,this.dashBoardService=n,this.activatedRoute=s,this.submissionService=r,this.router=l,this.auth=p,this.dialogs=Ie,this.dashboard=Ae,this.formTabs=[],this.activeIndex=0,this.formDataIds=[],this.formSubmission=new S.X([]),this.destroy$=new g.x,this.activeItemIndex=0,this.options={disableAlerts:!0,noDefaultSubmitButton:!0},this.formValues=[],this.carouselIndex=0,this.items=[],this.userListForEmail=[],this.search$=new g.x,this.saveDialogSubscription=[],this.limit=10,this.page=0,this.creatingSubmission=new g.x,this.currentUser=this.auth.currentUserValue,this.initWorkflowForm(),this.activatedRoute.params.pipe((0,c.R)(this.destroy$)).subscribe(h=>this.subModuleId=h.id),this.populateData(),this.search$.pipe((0,J.w)(h=>this.dashboard.getAllUsersForListing(this.limit,this.page,h))).subscribe(h=>{h&&(this.userListForEmail=h?.results?.map(z=>z?.email))}),this.dashboard.getAllUsersForListing(this.limit,this.page).pipe((0,c.R)(this.destroy$)).subscribe(h=>{h&&(this.userListForEmail=h?.results?.map(z=>z?.email))})}openEmailNotifyModal(o,e,n){this.activeEmailIndex=n,this.currentFieldArray=e,this.saveDialogSubscription.push(this.dialogs.open(o,{dismissible:!1,closeable:!1}).subscribe())}onSearchChange(o){this.search$.next(o)}validateEmails(){let o=this.workflows.at(this.activeEmailIndex)?.get("emailNotifyTo")?.value;o=o.map(e=>!!/\S+@\S+\.\S+/.test(e)),o.includes(!1)?this.notif.displayNotification("Please provide valid email addresses","Email Notify","warning"):this.saveDialogSubscription.forEach(e=>e.unsubscribe())}cancelEmailNotify(){this.workflows.at(this.activeEmailIndex)?.get("emailNotifyTo")?.setValue([]),this.saveDialogSubscription.forEach(o=>o.unsubscribe())}populateData(){this.activatedRoute.params.pipe((0,G.j)("id"),(0,J.w)(o=>this.dashBoardService.getSubModuleByID(o)),(0,c.R)(this.destroy$)).subscribe(o=>{if(o){this.subModuleData=o,this.formWithWorkflow=o?.formIds?.map(n=>({...n,components:n.components?.map(s=>(s?.label&&"Submit"==s?.label&&(s.hidden=!0),s))})),this.formTabs=o?.formIds?.map(n=>n.title),this.items=o?.workFlowId?.stepIds?.map(n=>({approvers:n?.approverIds?.map(s=>s?.fullName),condition:n?.condition,emailNotifyTo:n?.emailNotifyToId?.notifyUsers||[]})),this.createdByUser=o?.createdBy;const e=o?.workFlowId?.stepIds?.map(n=>({approverIds:n?.approverIds?.map(s=>({name:s?.fullName,id:s?.id,control:new u.NI(!0)})),condition:n?.condition,emailNotifyTo:n?.emailNotifyToId?.notifyUsers||[]}));delete this.subModuleData?.workFlowId,Object.assign(this.subModuleData,{workFlowId:e}),this.initWorkflowForm(e)}})}initWorkflowForm(o){this.workflowForm=this.fb.group(o?{workflows:this.fb.array(o?.map(e=>this.fb.group({condition:[e.condition,u.kI.required],approverIds:[e.approverIds,u.kI.required],emailNotifyTo:[e?.emailNotifyTo||[],u.kI.required]})))}:{workflows:this.fb.array([this.fb.group({condition:["",u.kI.required],approverIds:[[],u.kI.required],emailNotifyTo:[[],u.kI.required]})])})}get workflows(){return this.workflowForm.controls.workflows}addWorkflowStep(){const o=this.fb.group({approverIds:[[],u.kI.required],condition:[{value:"",disabled:""},u.kI.required],emailNotifyTo:[[],u.kI.required]});this.workflows.push(o)}removeWorkflowStep(o){this.workflows.removeAt(o)}getApproverList(o,e){this.workflows.at(e)?.get("approverIds")?.setValue(o)}onChange(o,e){if(o?.data&&o?.changed){const n=this.subModuleData?.formIds[this.activeIndex]?.id;this.formValues[this.activeIndex]={...o,formId:n};const s=this.formValues?.map(r=>({formId:r?.formId,data:r?.data}));this.formSubmission.next(s)}}dataSubmitValidation(){return!(0==this.workflows?.length||this.workflows.controls.map(o=>0==o.get("approverIds")?.value.length).includes(!0)||!0===this.workflows.controls.map(o=>o.get("condition")?.value).includes(""))}createSubmission(o){if(0==this.dataSubmitValidation())return this.notif.displayNotification("Please provide valid condition for the workflow step/s","Create Submission","warning");if(this.workflows.controls.map(n=>n.get("approverIds")?.value.length>1&&n.get("condition")?.value).includes("none"))return this.notif.displayNotification("Please provide valid condition for the workflow step/s","Create Submission","warning");if(this.formSubmission?.value?.length!==this.formWithWorkflow?.length)return this.notif.displayNotification("Please provide data for all form fields","Create Submission","warning");this.creatingSubmission.next(!0);const e={subModuleId:this.subModuleId,formIds:this.subModuleData?.formIds?.map(n=>n.id),formDataIds:this.formSubmission?.value,submissionStatus:o||void 0,steps:this.workflows?.value?.map(n=>({approverIds:n?.approverIds?.map(s=>s.id?s.id:s),condition:n?.condition,emailNotifyTo:n?.emailNotifyTo||[]}))};this.submissionService.addNewSubmission(e).pipe((0,c.R)(this.destroy$)).subscribe(n=>{n&&(this.creatingSubmission.next(!1),this.router.navigate(["/submodule/submissions/view-submissions",this.subModuleId]))})}countUsers(o,e){o<2&&(this.workflows.at(e)?.get("condition")?.setValue("none"),this.notif.displayNotification('Default condition of "None" will be used if the number of approvers is less than 2',"Create Module","warning")),o>=2&&"none"==this.workflows.at(e)?.get("condition")?.value&&this.notif.displayNotification("Please select either AND or OR as the condition","Create Module","warning")}validateSelection(o){this.workflows.at(o)?.get("approverIds")?.value?.length<2&&(this.workflows.at(o)?.get("condition")?.setValue("none"),this.notif.displayNotification('Default condition of "None" will be used if the number of approvers is less than 2',"Create Module","warning")),this.workflows.at(o)?.get("approverIds")?.value?.length>=2&&"none"==this.workflows.at(o)?.get("condition")?.value&&this.notif.displayNotification("Please select either AND or OR as the condition","Create Module","warning")}cancelSubmission(){this.router.navigate(["/submodule/submissions/view-submissions",this.subModuleId])}ngOnDestroy(){this.destroy$.complete(),this.destroy$.unsubscribe()}}I.\u0275fac=function(o){return new(o||I)(t.Y36(u.qu),t.Y36(Q.T),t.Y36(Y.s),t.Y36(m.gz),t.Y36(f),t.Y36(m.F0),t.Y36(L.e),t.Y36($.RO),t.Y36(Y.s))},I.\u0275cmp=t.Xpm({type:I,selectors:[["ng-component"]],decls:26,vars:8,consts:[[1,"w-11/12","h-auto","min-h-screen","mx-auto","mt-52","pb-44"],[1,"flex","flex-col","w-full","px-5","mx-auto","mt-5","border","border-gray-400","border-dashed","rounded-md","bg-gray-50"],[1,"flex","justify-between","my-8"],["tuiTabs","","vertical","left",1,"w-32","mr-5"],[4,"ngFor","ngForOf"],[3,"activeItemIndex","activeItemIndexChange"],["tuiTab",""],["src","tuiIconEye",1,"tui-space_right-2"],["src","tuiIconEdit",1,"tui-space_right-2"],["class","mt-12",3,"formGroup",4,"ngIf"],[4,"ngIf"],[1,"flex","justify-end","gap-5","mt-8"],["tuiButton","","type","button","size","m","appearance","primary",3,"showLoader","click"],["tuiButton","","type","button","size","m","appearance","accent",3,"click"],["template",""],["hint",""],["tuiTab","",3,"click"],["class","w-full well jsonviewer",4,"ngIf"],[1,"w-full","well","jsonviewer"],[3,"submission","options","form","change"],[1,"mt-12",3,"formGroup"],[1,"text-lg","font-semibold"],["formArrayName","workflows"],["tuiIconButton","","type","button","size","m","appearance","primary","icon","tuiIconPlusLarge",3,"click"],[1,"text-base","font-semibold","mt-7"],[1,"grid","grid-cols-12","gap-3","my-4",3,"formGroupName"],[1,"col-span-4"],[1,"block","pb-1"],[1,"text-xs","text-red-400"],["formControlName","approverIds",3,"checkUsersLength","approverList"],["for","conditionSelect",1,"block","pb-1"],["formControlName","condition","aria-label","Default select example","id","conditionSelect",1,"h-10","form-select","form-control",3,"change"],["value","and"],["value","or"],["value","none"],[1,"col-span-1","mt-8","inline-flex"],["direction","right",1,"mr-4","mt-1","-ml-2",3,"content"],[3,"contentTop","colorTop"],["tuiIconButton","","type","button","size","s","appearance","outline","icon","tuiIconMailLarge",3,"click"],[1,"col-span-1","mt-8","-ml-8"],["tuiIconButton","","type","button","size","s","appearance","secondary-destructive","icon","tuiIconTrash2Large",3,"click"],["size","l",1,"w-full","my-4","shadow-lg","border","border-[#F15B41]","px-5","mx-auto"],[1,"mb-5","text-base","font-semibold","text-gray-700"],[3,"draggable","itemsCount","index","indexChange"],["size","s",1,"my-5","pagination",3,"length","index","indexChange"],["class","flex justify-between w-full",4,"tuiItem"],[1,"flex","justify-between","w-full"],[1,"relative","w-full","px-4","py-4","text-left","border","border-gray-200","rounded-md","bg-gray-50"],[1,"mb-2","text-lg","font-semibold","text-gray-700"],["class","px-5",4,"ngFor","ngForOf"],[1,"absolute","top-0","right-0","px-3","py-1","text-sm","font-semibold","bg-gray-200","rounded-b-none","text-slate-700","rounded-r-md"],[1,"ml-4","mt-7"],["class","fa fa-long-arrow-right fa-lg","aria-hidden","true",4,"ngIf"],[1,"px-5"],[1,"list-disc"],["aria-hidden","true",1,"fa","fa-long-arrow-right","fa-lg"],[1,"text-lg","font-semibold","text-center"],[1,"mt-3","text-base","font-medium","text-gray-500"],[1,"flex","flex-col","justify-center","my-5"],[1,"b-form",3,"formControl","tuiTextfieldLabelOutside","searchChange"],[3,"items",4,"tuiDataList"],[1,"flex","justify-start","gap-x-3"],["tuiButton","","type","button","size","m",3,"click"],["appearance","accent","tuiButton","","type","button","size","m",3,"click"],[3,"items"],[1,"text-base"],[1,"mt-2"],[1,"my-2"]],template:function(o,e){1&o&&(t._UZ(0,"app-header"),t.TgZ(1,"section",0)(2,"div",1)(3,"section",2)(4,"nav",3),t.YNc(5,de,3,1,"ng-container",4),t.qZA(),t.YNc(6,me,2,1,"ng-container",4),t.qZA()(),t.TgZ(7,"tui-tabs",5),t.NdJ("activeItemIndexChange",function(s){return e.activeItemIndex=s}),t.TgZ(8,"button",6),t._UZ(9,"tui-svg",7),t._uU(10," Approval Workflow "),t.qZA(),t.TgZ(11,"button",6),t._UZ(12,"tui-svg",8),t._uU(13," Modify Workflow "),t.qZA()(),t.YNc(14,fe,6,2,"div",9),t.YNc(15,ve,7,6,"ng-container",10),t.TgZ(16,"div",11)(17,"button",12),t.NdJ("click",function(){return e.createSubmission()}),t.ALo(18,"async"),t._uU(19," Create submission "),t.qZA(),t.TgZ(20,"button",13),t.NdJ("click",function(){return e.cancelSubmission()}),t._uU(21," Cancel "),t.qZA()()(),t.YNc(22,ye,13,2,"ng-template",null,14,t.W1O),t.YNc(24,ke,16,0,"ng-template",null,15,t.W1O)),2&o&&(t.xp6(5),t.Q6J("ngForOf",e.formTabs),t.xp6(1),t.Q6J("ngForOf",e.formWithWorkflow),t.xp6(1),t.Q6J("activeItemIndex",e.activeItemIndex),t.xp6(7),t.Q6J("ngIf",1==e.activeItemIndex),t.xp6(1),t.Q6J("ngIf",0==e.activeItemIndex),t.xp6(2),t.Q6J("showLoader",t.lcZ(18,6,e.creatingSubmission)))},dependencies:[d.sg,d.O5,O.G,E.k4,W.h,u.YN,u.Kr,u.EJ,u.JJ,u.JL,u.oH,u.sg,u.u,u.x0,u.CE,C.PN,q.v0,_.H9,_.p_,_.uW,_.yu,ce.w,B.r,ft.e,j.VF,j.EB,ct.PZ,dt.eC,ue.gX,pt.V,mt.xT,gt.w,d.Ov]});class A{constructor(o,e,n){this.activatedRoute=o,this.workflowService=e,this.notif=n,this.destory$=new g.x,this.savingDecision=new S.X(!0),this.activatedRoute.queryParams.pipe((0,c.R)(this.destory$)).subscribe(s=>{if(s){const r={stepId:s.stepId,userId:s.userId,isApproved:Boolean(s.isApproved)};this.userDecision=r.isApproved,this.savingDecision.next(!0),this.workflowService.updateSubmissionWorkflow(s.submissionId,r).pipe((0,c.R)(this.destory$)).subscribe(l=>{console.log(l),this.savingDecision.next(!1)})}else this.savingDecision.next(!1),this.notif.displayNotification("Something Went Wrong","Update Submission","error")})}ngOnDestroy(){this.destory$.complete(),this.destory$.unsubscribe()}}A.\u0275fac=function(o){return new(o||A)(t.Y36(m.gz),t.Y36(f),t.Y36(Q.T))},A.\u0275cmp=t.Xpm({type:A,selectors:[["ng-component"]],decls:14,vars:6,consts:[["size","xxl",3,"inheritColor","overlay","showLoader"],[1,"w-screen","h-screen","sm:h-80","bg-[#808285]","relative"],[1,"absolute","w-11/12","px-4","py-2","mx-3","text-center","bg-white","rounded-lg","shadow-lg","left-2","sm:left-1/4","top-32","sm:w-1/2","sm:top-1/2"],[1,"pt-3","w-26","h-26","absolute","-top-16","-translate-x-1/2","left-1/2"],["ngSrc","../../../../assets/depa_logo.svg","width","100","height","100"],[1,"my-16","px-4"],[1,"pt-2","text-4xl","tracking-widest","font-semibold"],[1,"py-4","text-lg","tracking-widest"],[1,"text-gray-600","font-semibold"]],template:function(o,e){1&o&&(t.TgZ(0,"tui-loader",0),t.ALo(1,"async"),t.TgZ(2,"section",1)(3,"div",2)(4,"div",3),t._UZ(5,"img",4),t.qZA(),t.TgZ(6,"div",5)(7,"h2",6),t._uU(8,"Hello!"),t.qZA(),t.TgZ(9,"p",7),t._uU(10,"You have chosen to "),t.TgZ(11,"span",8),t._uU(12),t.qZA(),t._uU(13," this step. Your decision has been saved and the workflow has been updated. You may now close this page"),t.qZA()()()()()),2&o&&(t.Q6J("inheritColor",!0)("overlay",!0)("showLoader",!0===t.lcZ(1,4,e.savingDecision)),t.xp6(12),t.Oqu(!0===e.userDecision?"Approve":"Reject"))},dependencies:[d.Zd,F.kM,d.Ov]});var P=a(14371);const Ce=[{path:"",component:b,data:{breadcrumb:"Submissions"},children:[{path:"view-workflow/:id",canActivate:[P.a],component:T,data:{breadcrumb:"View Workflow"}},{path:"view-submissions/:id",canActivate:[P.a],component:Z},{path:"add-submission/:id",canActivate:[P.a],component:I,data:{breadcrumb:"Add Submission"}},{path:"email-submission",component:A},{path:"",canActivate:[P.a],component:b}]}];class x{}x.\u0275fac=function(o){return new(o||x)},x.\u0275mod=t.oAB({type:x}),x.\u0275inj=t.cJS({imports:[m.Bz.forChild(Ce),m.Bz]});var Te=a(44886),Ze=a(69952);class y{}y.\u0275fac=function(o){return new(o||y)},y.\u0275mod=t.oAB({type:y}),y.\u0275inj=t.cJS({imports:[d.ez,x,O.G,V.c,E.XI,D.V5,W.y,u.UX,Dt,at.f,C.EI,q.fN,_.$$,Ze.x,B.i,ft.e,F.dS,j.Xj,ct.cB,dt.zX,pt.f,mt.cn,lt.X,ut.z,Te.go,gt.Q,v]})}}]);