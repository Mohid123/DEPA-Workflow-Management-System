"use strict";(self.webpackChunkDEPA_FRONTEND=self.webpackChunkDEPA_FRONTEND||[]).push([[177],{21177:(O,C,n)=>{n.r(C),n.d(C,{FormsModule:()=>h});var f=n(36895),y=n(19132),t=n(94650);class g{}g.\u0275fac=function(o){return new(o||g)},g.\u0275cmp=t.Xpm({type:g,selectors:[["app-forms"]],decls:1,vars:0,template:function(o,e){1&o&&t._UZ(0,"router-outlet")},dependencies:[y.lC]});var l=n(90433),b=n(77579),_=n(82722),Z=n(92340),D=n(20696),I=n(22603),E=n(94051),v=n(60101),u=n(60946),T=n(39367);const M=["json"],N=["code"];function J(i,o){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",4),t.NdJ("click",function(){const m=t.CHM(e).index,c=t.oxw();return c.activeIndex=m,t.KtG(c.onJsonView())}),t._UZ(2,"i",5),t._uU(3),t.qZA(),t.BQk()}if(2&i){const e=o.$implicit;t.xp6(2),t.Tol(e.icon),t.xp6(1),t.hij(" \xa0 ",e.text," ")}}function w(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"section",6)(1,"div",7)(2,"div",8)(3,"label",9),t._uU(4,"Title"),t.qZA(),t._UZ(5,"input",10),t.qZA()(),t.TgZ(6,"form-builder",11),t.NdJ("change",function(s){t.CHM(e);const m=t.oxw();return t.KtG(m.onChange(s))}),t.qZA(),t.TgZ(7,"div",12)(8,"button",13),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.submitFormData())}),t._uU(9," Submit Form "),t.qZA(),t.TgZ(10,"button",14),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.cancelFormData())}),t._uU(11," Cancel "),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(5),t.Q6J("formControl",e.formTitleControl),t.xp6(1),t.Q6J("form",e.form)}}function B(i,o){if(1&i&&(t.TgZ(0,"section",6)(1,"div",15),t._UZ(2,"formio",16),t.qZA()()),2&i){const e=t.oxw();t.xp6(2),t.Q6J("form",e.form)("refresh",e.refreshForm)}}function S(i,o){1&i&&(t.TgZ(0,"section",6)(1,"div",15)(2,"pre",17),t._UZ(3,"code",18),t.qZA()()())}class F{constructor(o,e,r,s,m){this.transportService=o,this.notif=e,this.location=r,this.activatedRoute=s,this.formService=m,this.refreshForm=new t.vpe,this.activeIndex=0,this.editMode=!1,this.items=[{text:"Form Builder",icon:"fa fa-file-text-o fa-lg"},{text:"Preview",icon:"fa fa-eye fa-lg"},{text:"JSON view",icon:"fa fa-file-code-o fa-lg"}],this.formTitleControl=new l.NI({value:"",disabled:this.editMode}),this.formDisplayType=new l.NI("form"),this.destroy$=new b.x,this.crudUsers=new l.NI([]),this.viewUsers=new l.NI([]),this.editMode=this.transportService.isFormEdit.value,this.activatedRoute.queryParams?.subscribe(c=>{c.key&&this.formService.getFormByKey(c.key).pipe((0,_.R)(this.destroy$)).subscribe(d=>{d&&(this.form=d,this.formTitleControl.setValue(d?.title))}),!0===this.editMode?(this.form=this.transportService.sendFormDataForEdit.value,this.formTitleControl.setValue(this.transportService.sendFormDataForEdit.value.title),this.formTitleControl.disable()):this.form={title:this.formTitleControl?.value,key:"",display:this.formDisplayType.value,components:[]}})}onChange(o){this.refreshForm.emit({property:"form",value:o.form}),o.form.display=this.formDisplayType?.value,o.form.title=this.formTitleControl?.value,this.formValue=o.form,this.form?.components?.map(e=>(e?.label&&"Upload"===e?.label&&(e.storage="url",e.url=`${Z.N.apiUrl}/upload`,e.uploadEnabled=!0,e.sendFileAsQueryParam=!1,e.input=!0,e.type="file",e.multiple=!0),e))}onJsonView(){setTimeout(()=>{const o=document.getElementById("json_code");o&&(o.innerHTML=""),o?.appendChild(document.createTextNode(JSON.stringify(this.formValue,null,4)))},500)}submitFormData(){if(!this.formTitleControl?.value||""==this.formTitleControl?.value)return this.notif.displayNotification("Please provide a title for your form","Create Form","warning");if(0==this.form?.components?.length)return this.notif.displayNotification("You have not created a form!","Create Form","warning");if(this.form.title=this.formTitleControl?.value,this.form.display=this.formDisplayType?.value,this.form.key=this.formTitleControl?.value?.replace(/\s+/g,"-").trim().toLowerCase(),0==this.editMode)if(this.transportService.formBuilderData.value[0].components?.length>0){const o=[...this.transportService.formBuilderData.value,this.form];this.transportService.sendFormBuilderData(o),this.location.back()}else this.transportService.sendFormBuilderData([this.form]),this.location.back();else{const o=this.transportService.formBuilderData.value?.map(e=>(e.title==this.form?.title&&(e=this.form),e));this.transportService.sendFormBuilderData(o),this.location.back()}}setSelectValue(o){this.formDisplayType.setValue(o.target.value)}cancelFormData(){if(0==this.editMode)this.transportService.sendFormBuilderData([{title:"",key:"",display:"",components:[]}]),this.location.back();else{const o=this.transportService.formBuilderData.value?.map(e=>(e.title==this.form?.title&&(e=this.form),e));this.transportService.sendFormBuilderData(o),this.location.back()}}ngOnDestroy(){this.destroy$.complete(),this.destroy$.unsubscribe()}}F.\u0275fac=function(o){return new(o||F)(t.Y36(D.R),t.Y36(I.T),t.Y36(f.Ye),t.Y36(y.gz),t.Y36(E.s))},F.\u0275cmp=t.Xpm({type:F,selectors:[["ng-component"]],viewQuery:function(o,e){if(1&o&&(t.Gf(M,7),t.Gf(N,7)),2&o){let r;t.iGM(r=t.CRH())&&(e.jsonElement=r.first),t.iGM(r=t.CRH())&&(e.codeElement=r.first)}},decls:6,vars:5,consts:[[1,"py-5"],["tuiMobileTabs","",1,"flex","justify-center","mx-2","lg:mx-20","md:mx-10",3,"activeItemIndex"],[4,"ngFor","ngForOf"],["class","px-5",4,"ngIf"],["tuiTab","","tuiRipple","var(--tui-text-01)",3,"click"],["alt","svg-icon",1,"pr-1"],[1,"px-5"],[1,"grid","w-8/12","grid-cols-12","gap-3","px-1","mx-auto","my-4"],[1,"col-span-6"],["for","titleField"],["type","text","placeholder","Form title","id","titleField",1,"form-control",3,"formControl"],[3,"form","change"],[1,"flex","justify-center","py-3"],["tuiButton","","type","button","size","m","appearance","accent",1,"tui-space_right-3","tui-space_bottom-3",3,"click"],["tuiButton","","type","button","size","m","appearance","secondary-destructive",1,"tui-space_right-3","tui-space_bottom-3",3,"click"],[1,"well","jsonviewer"],[3,"form","refresh"],["id","json"],["id","json_code",1,"language-json"]],template:function(o,e){1&o&&(t.TgZ(0,"section",0)(1,"tui-tabs",1),t.YNc(2,J,4,3,"ng-container",2),t.qZA()(),t.YNc(3,w,12,2,"section",3),t.YNc(4,B,3,2,"section",3),t.YNc(5,S,4,0,"section",3)),2&o&&(t.xp6(1),t.Q6J("activeItemIndex",e.activeIndex),t.xp6(1),t.Q6J("ngForOf",e.items),t.xp6(1),t.Q6J("ngIf",0==e.activeIndex),t.xp6(1),t.Q6J("ngIf",1===e.activeIndex),t.xp6(1),t.Q6J("ngIf",2===e.activeIndex))},dependencies:[f.sg,f.O5,v.k4,v.hd,u.H9,u.p_,u.yu,T.v0,l.Fj,l.JJ,l.oH]});var a=n(4266),k=n(15274);const j=["json"],U=["code"];function A(i,o){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",4),t.NdJ("click",function(){const m=t.CHM(e).index,c=t.oxw();return c.activeIndex=m,t.KtG(c.onJsonView())}),t._UZ(2,"i",5),t._uU(3),t.qZA(),t.BQk()}if(2&i){const e=o.$implicit;t.xp6(2),t.Tol(e.icon),t.xp6(1),t.hij(" \xa0 ",e.text," ")}}function Q(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"section",6)(1,"div",7)(2,"div",8)(3,"label",9),t._uU(4,"Title"),t.qZA(),t._UZ(5,"input",10),t.qZA()(),t.TgZ(6,"form-builder",11),t.NdJ("change",function(s){t.CHM(e);const m=t.oxw();return t.KtG(m.onChange(s))}),t.qZA(),t.TgZ(7,"div",12)(8,"button",13),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.submitFormData())}),t._uU(9," Submit Form "),t.qZA(),t.TgZ(10,"button",14),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.cancelFormData())}),t._uU(11," Cancel "),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(5),t.Q6J("formControl",e.formTitleControl),t.xp6(1),t.Q6J("form",e.form)}}function Y(i,o){if(1&i&&(t.TgZ(0,"section",6)(1,"div",15),t._UZ(2,"formio",16),t.qZA()()),2&i){const e=t.oxw();t.xp6(2),t.Q6J("form",e.form)("refresh",e.refreshForm)}}function R(i,o){1&i&&(t.TgZ(0,"section",6)(1,"div",15)(2,"pre",17),t._UZ(3,"code",18),t.qZA()()())}class x{constructor(o,e,r,s,m){this.notif=o,this.activatedRoute=e,this.formService=r,this._location=s,this.auth=m,this.refreshForm=new t.vpe,this.activeIndex=0,this.editMode=!1,this.items=[{text:"Form Builder",icon:"fa fa-file-text-o fa-lg"},{text:"Preview",icon:"fa fa-eye fa-lg"},{text:"JSON view",icon:"fa fa-file-code-o fa-lg"}],this.formTitleControl=new l.NI({value:"",disabled:this.editMode}),this.formDisplayType=new l.NI("form"),this.destroy$=new b.x,this.crudUsers=new l.NI([]),this.viewUsers=new l.NI([]),this.activatedRoute?.queryParams?.subscribe(c=>{c.id?(this.editFormID=c.id,this.formService.getFormById(c.id).pipe((0,_.R)(this.destroy$)).subscribe(d=>{d&&(this.form=d,this.formTitleControl.setValue(d?.title))})):this.form={title:this.formTitleControl?.value,key:null,display:this.formDisplayType.value||null,components:[]}})}onChange(o){this.refreshForm.emit({property:"form",value:o.form}),o.form.display=this.formDisplayType?.value,o.form.title=this.formTitleControl?.value,this.formValue=o.form,this.form?.components?.map(e=>(e?.label&&"Upload"===e?.label&&(e.storage="url",e.url="http://localhost:3000/v1/upload",e.uploadEnabled=!0,e.input=!0,e.multiple=!0),e))}onJsonView(){setTimeout(()=>{const o=document.getElementById("json_code");o&&(o.innerHTML=""),o?.appendChild(document.createTextNode(JSON.stringify(this.formValue,null,4)))},500)}submitFormData(){if(!this.formTitleControl?.value||""==this.formTitleControl?.value)return this.notif.displayNotification("Please provide a title for your form","Edit Form","warning");if(0==this.form?.components?.length)return this.notif.displayNotification("Your form cannot be empty!","Edit Form","warning");const o={title:this.formTitleControl?.value,key:this.formTitleControl?.value?.replace(/\s+/g,"-").toLowerCase(),display:this.form?.display??this.formDisplayType.value,components:this.form?.components},e=(0,a.rV)(a.MX.formEdit);this.editFormID?this.formService.updateForm(this.editFormID,o).pipe((0,_.R)(this.destroy$)).subscribe(r=>{r&&(e?((0,a.cl)(a.MX.formEdit),setTimeout(()=>this._location.back(),800)):this._location.back())}):(Object.assign(o,{subModuleId:(0,a.rV)(a.MX.moduleID)}),this.formService.createForm(o).pipe((0,_.R)(this.destroy$)).subscribe(r=>{r&&(e?((0,a.cl)(a.MX.formEdit),setTimeout(()=>this._location.back(),800)):this._location.back())}))}setSelectValue(o){this.formDisplayType.setValue(o.target.value)}cancelFormData(){(0,a.rV)(a.MX.formEdit)?((0,a.cl)(a.MX.formEdit),this._location.back()):this._location.back()}ngOnDestroy(){this.destroy$.complete(),this.destroy$.unsubscribe()}}x.\u0275fac=function(o){return new(o||x)(t.Y36(I.T),t.Y36(y.gz),t.Y36(E.s),t.Y36(f.Ye),t.Y36(k.e))},x.\u0275cmp=t.Xpm({type:x,selectors:[["ng-component"]],viewQuery:function(o,e){if(1&o&&(t.Gf(j,7),t.Gf(U,7)),2&o){let r;t.iGM(r=t.CRH())&&(e.jsonElement=r.first),t.iGM(r=t.CRH())&&(e.codeElement=r.first)}},decls:6,vars:5,consts:[[1,"py-5"],["tuiMobileTabs","",1,"mx-2","lg:mx-20","md:mx-10","flex","justify-center",3,"activeItemIndex"],[4,"ngFor","ngForOf"],["class","px-5",4,"ngIf"],["tuiTab","","tuiRipple","var(--tui-text-01)",3,"click"],["alt","svg-icon",1,"pr-1"],[1,"px-5"],[1,"grid","grid-cols-12","gap-3","w-8/12","mx-auto","px-1","my-4"],[1,"col-span-6"],["for","titleField"],["type","text","placeholder","Form title","id","titleField",1,"form-control",3,"formControl"],[3,"form","change"],[1,"flex","justify-center","py-3"],["tuiButton","","type","button","size","m","appearance","accent",1,"tui-space_right-3","tui-space_bottom-3",3,"click"],["tuiButton","","type","button","size","m","appearance","secondary-destructive",1,"tui-space_right-3","tui-space_bottom-3",3,"click"],[1,"well","jsonviewer"],[3,"form","refresh"],["id","json"],["id","json_code",1,"language-json"]],template:function(o,e){1&o&&(t.TgZ(0,"section",0)(1,"tui-tabs",1),t.YNc(2,A,4,3,"ng-container",2),t.qZA()(),t.YNc(3,Q,12,2,"section",3),t.YNc(4,Y,3,2,"section",3),t.YNc(5,R,4,0,"section",3)),2&o&&(t.xp6(1),t.Q6J("activeItemIndex",e.activeIndex),t.xp6(1),t.Q6J("ngForOf",e.items),t.xp6(1),t.Q6J("ngIf",0==e.activeIndex),t.xp6(1),t.Q6J("ngIf",1===e.activeIndex),t.xp6(1),t.Q6J("ngIf",2===e.activeIndex))},dependencies:[f.sg,f.O5,v.k4,v.hd,u.H9,u.p_,u.yu,T.v0,l.Fj,l.JJ,l.oH]});const H=[{path:"",component:g,children:[{path:"form-builder",component:F,data:{breadcrumb:"Form builder"}},{path:"edit-form",component:x,data:{breadcrumb:"Edit-Form"}},{path:"",redirectTo:"form-builder",pathMatch:"full"}]}];class p{}p.\u0275fac=function(o){return new(o||p)},p.\u0275mod=t.oAB({type:p}),p.\u0275inj=t.cJS({imports:[y.Bz.forChild(H),y.Bz]});var V=n(56546),G=n(77915);class h{}h.\u0275fac=function(o){return new(o||h)},h.\u0275mod=t.oAB({type:h}),h.\u0275inj=t.cJS({imports:[f.ez,p,v.XI,u.$$,T.fN,V.G,l.UX,G.e]})}}]);