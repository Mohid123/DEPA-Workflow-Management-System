<app-header></app-header>

<section class="w-11/12 h-auto min-h-screen mx-auto mt-52 pb-44">
  <p class="text-lg font-semibold">Form Title</p>
  <div class="px-5 py-5 rounded-md well jsonviewer bg-gray-50">
    <formio [form]="formWithWorkflow"></formio>
  </div>

  <section class="my-10">
    <p class="mb-5 text-lg font-semibold">Approval Workflow</p>
    <div class="flex flex-col items-center justify-center">
      <ng-container *ngFor="let user of workflowUsers; let i = index; let lastItem = last">
        <tui-island size="l" class="w-1/2 my-4 shadow-lg" [hoverable]="true">
          <ng-container *ngIf="user?.stepStatus == 'pending'">
            <tui-badge
              class="px-2 font-semibold text-white bg-yellow-600 tui-space_right-2 tui-space_bottom-4"
              [value]="'Pending'"
              status="custom"
            >
              <tui-svg src="tuiIconClock"></tui-svg>
            </tui-badge>
            <hr class="mb-2">
          </ng-container>
          <ng-container *ngIf="user?.stepStatus == 'rejected'">
            <tui-badge
              class="px-2 font-semibold text-white bg-red-600 tui-space_right-2 tui-space_bottom-4"
              [value]="'Rejected'"
              status="custom"
            >
              <tui-svg src="tuiIconAlertOctagon"></tui-svg>
            </tui-badge>
            <hr class="mb-2">
          </ng-container>
          <ng-container *ngIf="user?.stepStatus == 'approved'">
            <tui-badge
              class="px-2 font-semibold text-white bg-green-600 tui-space_right-2 tui-space_bottom-4"
              [value]="'Approved'"
              status="custom"
            >
              <tui-svg src="tuiIconCheckCircle"></tui-svg>
            </tui-badge>
            <hr class="mb-2">
          </ng-container>

          <ul class="tui-list">
            <ng-container *ngFor="let approvers of user?.approverIds; let j = index; let first = first; let last = last">
              <li class="tui-list__item">
                <div class="flex justify-between">
                  <span class="text-base font-semibold">{{approvers}}</span>
                  <div *ngIf="first" class="flex justify-end gap-5">
                    <span>Approve &nbsp; <tui-toggle (click)="showDialog(template)" [showLoader]="showLoader | async" size="l" [formControl]="approve"></tui-toggle></span>
                    <span>Reject &nbsp; <tui-toggle (click)="showDialog(template)" [showLoader]="showLoader | async" size="l" [formControl]="reject"></tui-toggle></span>
                  </div>
                </div>
              </li>
              <p class="mt-2 ml-8 font-normal" *ngIf="!last">{{user?.condition}}</p>
            </ng-container>
          </ul>
        </tui-island>
        <i *ngIf="!lastItem" class="fa fa-long-arrow-down fa-2x" aria-hidden="true"></i>
      </ng-container>
    </div>
  </section>

  <!--Workflow progress-->
  <section class="my-4">
    <p class="mb-5 text-lg font-semibold">Workflow Progress & Approval Logs</p>
    <div class="flex justify-between">
      <div>
        <label
          *ngIf="value$ | async as value"
          tuiProgressLabel
        >
          <span class="text">COMPLETED</span>
          <span class="percent">{{ value }}%</span>

          <tui-progress-circle
            size="xl"
            [max]="max"
            [value]="value"
            color="#f15b41"
          ></tui-progress-circle>
        </label>
      </div>

      <div class="flex flex-col">
        <div class="flex justify-between">

        </div>
      </div>
    </div>
  </section>

</section>

<app-footer></app-footer>

<ng-template #template let-observer>
  <p class="text-lg font-semibold text-center">You have chosen to
    <span class="mx-1 text-lg font-semibold" [ngClass]="approve?.value == true ? 'text-green-500' : 'text-red-500'">{{approve?.value == true ? 'Approve': 'Reject'}}</span> this step.
  </p>
  <p class="mt-3 text-base font-medium">Please add your comments below (if any) and send your decision</p>
  <div class="flex flex-col justify-center my-5">
    <label class="block" for="Textarea1">Comments</label>
    <textarea class="form-control" id="Textarea1" rows="4"></textarea>
  </div>
  <button
    tuiButton
    type="button"
    size="m"
    (click)="observer.complete()"
    >
      Send
    </button>
</ng-template>

