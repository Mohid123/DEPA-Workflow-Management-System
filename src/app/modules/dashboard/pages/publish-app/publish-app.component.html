<app-header></app-header>
<div class="bg_img_main">
  <section class="grid w-10/12 grid-cols-12 gap-4 mx-auto mt-48 pb-44">
    <div class="px-12 py-5 bg-white rounded-lg shadow-lg col-span-full">
      <p class="text-2xl font-bold text-center">Create new Module</p>
      <div class="flex justify-center my-6">
        <tui-tabs tuiMobileTabs [(activeItemIndex)]="activeIndex">
          <ng-container *ngFor="let tab of tabs; let i = index; let last = last; let first = first">
            <button
              disabled
              tuiTab
              class="text-base font-semibold text-black"
              [ngClass]="{'mr-10': first, 'ml-10': last, 'mx-10' : !last && !first}"
            >
            {{tab.text}}
          </button>
          </ng-container>
        </tui-tabs>
      </div>
      <form>
        <ng-container *ngIf="activeIndex == 0">
          <formio (submit)="nextStep($event)" [form]="moduleDetailsForm" [options]="options" [submission]="prePopulatedDataDetails"></formio>
        </ng-container>

        <ng-container *ngIf="activeIndex == 1">
          <div [formGroup]="workflowForm">
            <ng-container formArrayName="workflows">
              <ng-container *ngFor="let workflow of workflows.controls; let i = index">
                <p class="text-base font-semibold mt-7">Step {{i === 0 ? '1' : i+1}}</p>
                <div class="grid grid-cols-12 gap-3 my-4" [formGroupName]="i">
                  <div class="col-span-5">
                    <label class="block pb-1">Approvers <span class="text-xs text-red-400">*</span></label>
                    <custom-multi-select formControlName="approverIds" (approverList)="getApproverList($event, i)"></custom-multi-select>
                  </div>
                  <div class="col-span-5">
                    <label for="conditionSelect" class="block pb-1">Condition <span class="text-xs text-red-400">*</span></label>
                    <select formControlName="condition" class="h-10 form-select form-control" aria-label="Default select example" id="conditionSelect">
                      <option value="and">AND</option>
                      <option value="or">OR</option>
                      <!-- <option value="any">ANY</option> -->
                    </select>
                  </div>
                  <div class="col-span-2 mt-8" *ngIf="i > 0">
                    <button
                      tuiIconButton
                      type="button"
                      size="s"
                      appearance="secondary-destructive"
                      icon="tuiIconTrash2Large"
                      (click)="removeWorkflowStep(i)"
                    ></button>
                  </div>
                </div>
              </ng-container>
            </ng-container>
            <button
              tuiIconButton
              type="button"
              size="m"
              appearance="primary"
              icon="tuiIconPlusLarge"
              (click)="addWorkflowStep()"
            ></button>

            <div class="flex justify-end gap-5 mt-5">
              <button (click)="previousStep()" type="button" class="px-4 py-2 text-base font-medium border border-gray-400 rounded-md bg-gray-50">Back</button>
              <button (click)="nextStep()" type="button" class="btn btn-primary">Proceed to Module Graphics</button>
            </div>
          </div>
        </ng-container>

        <ng-container *ngIf="activeIndex == 2">
          <label (change)="onFileSelect($event)" for="dropzone-file" class="flex flex-col items-center justify-center w-full h-64 mt-10 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500 dark:hover:bg-gray-600">
            <tui-loader
              [inheritColor]="true"
              [size]="'l'"
              [showLoader]="false"
              [overlay]="true"
            >
              <div *ngIf="file" class="flex justify-center">
                <img [src]="file" alt="app_icon" width="200" height="200" class="rounded-md">
              </div>
              <div *ngIf="!file" class="flex justify-start">
                <div class="mx-8">
                  <img src="../../../../../assets/windows.svg" width="32" height="32">
                </div>
                <div class="flex flex-col">
                  <p class="mb-3 text-lg font-semibold text-black">Module Icon</p>
                  <ul class="text-sm text-gray-400 list-disc">
                    <li>Icon should be 500x500 px (1:1) ratio</li>
                    <li>Only (JPEG, PNG, WEBP) extensions are allowed</li>
                    <li>Up to 1MB file size is allowed</li>
                  </ul>
                </div>
              </div>
            </tui-loader>
            <input id="dropzone-file" type="file" class="hidden" />
          </label>

          <div class="flex justify-end gap-5 mt-5">
            <button (click)="previousStep()" type="button" class="px-4 py-2 text-base font-medium border border-gray-400 rounded-md bg-gray-50">Back</button>
            <button (click)="nextStep()" type="button" class="btn btn-primary">
              {{(isCreatingModule | async) ? 'Please wait...' : 'Publish Module'}}
            </button>
          </div>
        </ng-container>

        <ng-container *ngIf="activeIndex == 3">
          <div class="flex flex-col items-center justify-center w-full mt-20">
            <img src="../../../../../assets/published.svg" alt="ok" width="118" height="118">
            <p class="my-2 text-lg font-semibold">Congratulations</p>
            <p class="text-base">Your module has been created successfully</p>
          </div>
        </ng-container>
      </form>
    </div>
  </section>
</div>
<app-footer></app-footer>

<ng-template #formError let-control="control" let-message="message" let-validation="validation">
  <ng-container *ngIf="control.hasError(validation) && (control.dirty || control.touched)">
    <div class="w-full mt-1 text-left fv-plugins-message-container text-xxs 2xl:text-xs">
      <span class="text-red-400 fv-help-block text-xxs 2xl:text-xs 2xl:mb-2" role="alert">
        {{ message }}
      </span>
    </div>
  </ng-container>
</ng-template>
