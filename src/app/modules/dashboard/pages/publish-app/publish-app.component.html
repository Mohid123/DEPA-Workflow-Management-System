<app-header></app-header>
<div class="bg_img_main">
  <section class="grid grid-cols-12 gap-4 w-10/12 mx-auto mt-48 pb-44">
    <div class="col-span-full bg-white rounded-lg shadow-lg px-12 py-5">
      <p class="font-bold text-2xl text-center">Publish an App</p>
      <div class="flex justify-center my-6">
        <tui-tabs tuiMobileTabs [(activeItemIndex)]="activeIndex">
          <ng-container *ngFor="let tab of tabs; let i = index; let last = last; let first = first">
            <button
              disabled
              tuiTab
              class="font-semibold text-base text-black"
              [ngClass]="{'mr-10': first, 'ml-10': last, 'mx-10' : !last && !first}"
            >
            {{tab.text}}
          </button>
          </ng-container>
        </tui-tabs>
      </div>
      <form [formGroup]="publishAppForm">
        <ng-container *ngIf="activeIndex == 0">
          <label class="text-sm font-bold block pb-2">App name <span class="tui-required"></span></label>
          <tui-input
            formControlName="appName"
            [tuiTextfieldCleaner]="true"
            tuiTextfieldSize="l"
            [tuiTextfieldLabelOutside]="true"
          >
            <input
              tuiTextfield
              type="text"
            />
          </tui-input>
          <div class="flex justify-between my-2">
            <p class="text-xs text-gray-500">This is how your app will appear on the app store, It should be clear and simple</p>
            <p [ngClass]="(appNameLength | async)! > 20 ? 'text-red-500': ''" class="text-xs text-gray-500">{{(appNameLength | async) || 0}}/20</p>
          </div>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'App name is required',
            control: f['appName']
          }"></ng-container>

          <div class="my-12">
            <label class="text-sm font-bold block pb-2">App URL <span class="tui-required"></span></label>
            <tui-input
              formControlName="appLink"
              [tuiTextfieldCleaner]="true"
              tuiTextfieldSize="l"
              [tuiTextfieldLabelOutside]="true"
            >
              <input
                tuiTextfield
                type="text"
              />
            </tui-input>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Please provide a valid app url',
              control: f['appLink']
            }"></ng-container>
          </div>

          <label class="text-sm font-bold block pb-2">Description <span class="tui-required"></span></label>
          <tui-text-area
            formControlName="fullDescription"
            [tuiTextfieldCleaner]="true"
            [tuiTextfieldLabelOutside]="true"
            class="min-h-40"
          >
          </tui-text-area>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'Please provide a description',
            control: f['fullDescription']
          }"></ng-container>
        </ng-container>

        <ng-container *ngIf="activeIndex == 1">
          <!--Categories-->
          <label class="text-sm font-bold block pb-2">App categories <span class="tui-required"></span></label>
          <tui-select formControlName="appCategories" [tuiTextfieldLabelOutside]="true">
            <input
              tuiTextfield
              placeholder="Select Categories"
            />
            <tui-data-list-wrapper
              *tuiDataList
              [items]="categoryOptions"
            ></tui-data-list-wrapper>
          </tui-select>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'Please select at least one category',
            control: f['appCategories']
          }"></ng-container>

          <!-- Companies-->
          <div class="mt-8 mb-4">
            <label class="text-sm font-bold block pb-2">Companies <span class="tui-required"></span></label>
            <tui-multi-select
              formControlName="companyNames"
              [tuiTextfieldCleaner]="true"
              tuiTextfieldSize="l"
              [tuiTextfieldLabelOutside]="true"
            >
              <input placeholder="Select Companies">
              <tui-data-list-wrapper
                *tuiDataList
                tuiMultiSelectGroup
                [items]="categoryOptions"
              >
            </tui-data-list-wrapper>
            </tui-multi-select>
            <div class="my-2">
              <p class="text-xs text-gray-500">If your company isn't listed, you can add it below</p>
            </div>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Please select at least one company',
              control: f['companyNames']
            }"></ng-container>
          </div>
          <ng-container formArrayName="companies">
            <ng-container *ngFor="let company of companies.controls; let j = index; let first = first; let last = last">
              <form class="px-8 w-7/12" [formGroupName]="j">
                <div class="flex justify-between items-center mb-3 gap-2 w-full">
                  <div class="w-full">
                    <label *ngIf="j == 0" class="text-xs font-semibold block pb-2">Add new companies</label>
                    <tui-input
                      formControlName="title"
                      [tuiTextfieldCleaner]="true"
                      tuiTextfieldSize="m"
                      [tuiTextfieldLabelOutside]="true"
                    >
                      <input
                        tuiTextfield
                        type="text"
                      />
                    </tui-input>
                  </div>
                  <div [ngClass]="first ? 'mt-7': 'mt-0'">
                    <button
                      tuiIconButton
                      type="button"
                      size="s"
                      appearance="secondary-destructive"
                      icon="tuiIconTrash2Large"
                      (click)="removeCompany(j)"
                    ></button>
                  </div>
                </div>
                <div class="flex justify-end">
                  <button
                    *ngIf="last"
                    tuiButton
                    type="button"
                    class="mb-3"
                    size="m"
                    (click)="submitNewCompany()"
                  >Submit</button>
                </div>
              </form>
            </ng-container>
          </ng-container>
          <button
            tuiIconButton
            type="button"
            size="m"
            icon="tuiIconPlusLarge"
            (click)="addCompany()"
          ></button>

        </ng-container>

        <ng-container *ngIf="activeIndex == 2">
          <label (change)="onFileSelect($event)" for="dropzone-file" class="mt-10 flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500 dark:hover:bg-gray-600">
            <tui-loader
              [inheritColor]="true"
              [size]="'l'"
              [showLoader]="false"
              [overlay]="true"
            >
              <div *ngIf="file" class="flex justify-center">
                <img [src]="file" alt="app_icon" width="200" height="200" class="rounded-md">
              </div>
              <div *ngIf="!file" class="flex justify-start">
                <div class="mx-8">
                  <img src="../../../../../assets/windows.svg" width="32" height="32">
                </div>
                <div class="flex flex-col">
                  <p class="font-semibold text-black text-lg mb-3">App Icon</p>
                  <ul class="list-disc text-sm text-gray-400">
                    <li>Icon should be 500x500 px (1:1) ratio</li>
                    <li>Only (JPEG, PNG, WEBP) extensions are allowed</li>
                    <li>Up to 1MB file size is allowed</li>
                  </ul>
                </div>
              </div>
            </tui-loader>
            <input id="dropzone-file" type="file" class="hidden" />
          </label>
        </ng-container>

        <ng-container *ngIf="activeIndex == 3">
          <div class="mt-20 flex flex-col items-center justify-center w-full">
            <img src="../../../../../assets/published.svg" alt="ok" width="118" height="118">
            <p class="font-semibold my-2 text-lg">Congratulations</p>
            <p class="text-base">Your app has been added and sent for approval</p>
          </div>
        </ng-container>

        <div class="flex justify-end my-10">
          <a (click)="previousStep()" class="px-6 py-3 text-sm font-semibold text-gray-500 bg-[#F5F8FA] rounded-lg cursor-pointer hover:text-gray-500" [ngClass]="activeIndex < 3 ? 'mx-10': 'mr-10'">Back</a>
          <a *ngIf="activeIndex !== 3" (click)="moveNext()" [ngSwitch]="activeIndex" class="px-10 py-3 text-sm font-semibold text-white bg-[#00A3FF] rounded-lg cursor-pointer hover:text-white">
            <span *ngSwitchCase="0">Listing Details</span>
            <span *ngSwitchCase="1">App Graphics</span>
            <span *ngSwitchCase="2">Published</span>
          </a>
        </div>
      </form>
    </div>
  </section>
</div>
<app-footer></app-footer>

<ng-template #formError let-control="control" let-message="message" let-validation="validation">
  <ng-container *ngIf="control.hasError(validation) && (control.dirty || control.touched)">
    <div class="w-full mt-1 text-left fv-plugins-message-container text-xxs 2xl:text-xs">
      <span class="text-red-400 fv-help-block text-xxs 2xl:text-xs 2xl:mb-2" role="alert">
        {{ message }}
      </span>
    </div>
  </ng-container>
</ng-template>