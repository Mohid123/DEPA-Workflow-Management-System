<div class="flex justify-between mt-5 mb-2">
  <p class="text-left font-semibold text-lg mb-5">List of Submodules</p>
  <div class="cursor-pointer">
    <!-- <a *ngIf="isFilterApplied == true" class="px-6 py-3 rounded-md bg-[#CF2729] text-white no-underline hover:text-white text-base">Reset All Filters</a> -->
    <a *ngIf="currentUser.id == tableData?.results[0]?.moduleId?.createdBy || currentUser?.role == 'admin'" [routerLink]="['/submodule/add-submodule']" [queryParams]="{moduleID: moduleId}" class="px-6 py-3 rounded-md bg-[#a58f81] text-white no-underline hover:text-white text-base">+ Add submodule</a>
  </div>
</div>

<tui-loader [overlay]="true" size="xl" [showLoader]="fetchingTableData | async">
  <div class="relative overflow-x-auto rounded-lg shadow-lg">
    <table class="w-full text-sm text-left text-gray-500">
      <thead class="text-xs text-gray-700 uppercase bg-[#eae4d8]">
        <tr>
          <ng-container *ngFor="let column of tableColumns; let i = index; let first = first; let last = last;">
            <th scope="col" class="px-6 py-3 text-sm">
              {{column}} &nbsp;
              <ng-container *ngIf="column === 'Status'; else notStatus">
              </ng-container>
              <ng-template #notStatus>
                <ng-container *ngIf="column === 'Company Name'">
                  <filter
                    (sendSearchToTable)="sendSearchValue($event)"
                    [filterBy]="column"
                    [showSortCategories]="false"
                    [items]="filterMenuCompany"
                    (applyStatus)="sendFilters($event)"
                    (resetFilters)="resetFilterValues($event)"
                  >
                  </filter>
                </ng-container>
                <ng-container *ngIf="column === 'Submodule Code'">
                  <filter
                    (sendSearchToTable)="sendSearchValue($event)"
                    [filterBy]="column"
                    [items]="filterMenuSubmodule"
                    (applyStatus)="sendFilters($event)"
                    (resetFilters)="resetFilterValues($event)"
                  >
                  </filter>
                </ng-container>
              </ng-template>
            </th>
          </ng-container>
          <th scope="col" class="py-3 text-sm text-center">
            Actions
          </th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngIf="tableData?.length == 0; else showSubModules">
          <th colspan="12" role="row" class="px-5 py-10 text-lg text-center">
            It seems there is no data to show here!
          </th>
        </ng-container>

        <ng-template #showSubModules>
          <ng-container *ngFor="let data of tableData?.results; let i = index; let first = first; let last = last">
            <tr class="bg-white border-b border-gray-300">
              <td class="px-6 py-4">
                {{data?.companyId?.title}}
              </td>
              <td class="px-6 py-4">
                {{data?.code}}
              </td>
              <td class="px-6 py-4">
                {{data?.status === 1 ? 'Published' : 'Rejected'}}
              </td>
              <td class="py-4 text-center">
                <div style="all: unset;" *ngIf="data?.status == 1">
                  <!-- here permissions cannot be set because workflow users cannot proceed if conditions are applied -->
                  <a [routerLink]="['/submodule/submissions/view-submissions', data?.id]" class="px-2 py-1 text-xs font-medium text-white no-underline bg-[#808285] rounded-md cursor-pointer mr-2 hover:text-white">
                    <i class="fa fa-print fa-lg" aria-hidden="true"></i> Submissions
                  </a>
                </div>
                <a *ngIf="currentUser.id == data?.createdBy || currentUser?.role == 'admin'" [routerLink]="['/submodule/edit-submodule', data?.id]" [queryParams]="{moduleID: moduleId, moduleCode: moduleCode}" class="px-2 py-1 text-xs font-medium text-white no-underline bg-blue-400 rounded-md cursor-pointer hover:text-white">
                  <i class="fa fa-pencil fa-lg" aria-hidden="true"></i> Edit
                </a>
                <a *ngIf="currentUser.id == data?.createdBy || currentUser?.role == 'admin'" (click)="showDialog(data?.id, template)" class="font-medium ml-2 px-2 py-1 bg-[#cf2729] text-white rounded-md hover:text-white no-underline cursor-pointer text-xs">
                  <i class="fa fa-trash-o fa-lg" aria-hidden="true"></i> Delete
                </a>
                <a *ngIf="checkIfUserisViewOnly(data?.viewOnlyUsers) || checkIfUserisAdmin(data?.adminUsers) || currentUser.id == data?.createdBy || currentUser?.role == 'admin'" [routerLink]="['/submodule/submodule-details', data?.code]" class="px-2 py-1 ml-2 text-xs font-medium text-white no-underline bg-green-400 rounded-md cursor-pointer hover:text-white">
                  <i class="fa fa-eye fa-lg" aria-hidden="true"></i> View
                </a>
              </td>
            </tr>
          </ng-container>
        </ng-template>
      </tbody>
    </table>
    <div class="pt-10 pb-6">
      <tui-pagination
        [length]="tableData?.totalPages || 1"
        [index]="tableData?.page - 1 || 0"
        (indexChange)="goToPage($event)"
      ></tui-pagination>
    </div>
  </div>
</tui-loader>

<ng-template #template let-observer>
  <p class="pb-2 text-xl font-semibold text-center border-b border-gray-400">Delete SubModule</p>
  <p class="mt-4 text-base font-medium text-center">Are you sure you want to delete this submodule?</p>
  <div class="flex justify-center mt-4">
    <button
      tuiButton
      appearance="secondary-destructive"
      type="button"
      size="m"
      class="mx-3"
      (click)="deleteModule(); observer.complete()"
      >
      Confirm
    </button>

    <button
      tuiButton
      type="button"
      size="m"
      (click)="observer.complete()"
      >
      Cancel
    </button>
  </div>
</ng-template>
