<ng-container *ngIf="submissionData as tableData; else noData">
  <!-- <p class="text-left font-semibold text-base mb-7">Code:&nbsp; <span class="text-[#374151]">{{submoduleData?.code}}</span> </p> -->
  <div class="flex justify-between mb-5">
    <p class="text-left font-semibold text-lg">List of Submissions</p>
    <div *ngIf="checkIfUserisAdmin() || submoduleData?.createdBy == currentUser?.id || currentUser?.role == 'admin'" class="cursor-pointer">
      <a (click)="addSubmissionRoute()" class="px-6 py-3 rounded-md bg-[#a58f81] text-white no-underline hover:text-white text-base">+ Add submission</a>
    </div>
  </div>
  <div class="relative overflow-x-auto rounded-lg shadow-lg">
    <table class="w-full text-sm text-left text-gray-500">
      <thead class="text-xs text-gray-700 uppercase bg-[#eae4d8]">
        <tr>
          <th class="px-4 py-3 text-sm">
            Submission Status&nbsp;
            <filter
              [filterBy]="'Status'"
              [items]="statusMenu"
              [searchEnabled]="false"
              (applyStatus)="sendFilterValue($event)"
              (resetFilters)="resetFilterValues($event)"
            >
            </filter>
          </th>
          <th class="px-2 py-3 text-sm">Last Activity By</th>
          <th class="px-2 py-3 text-sm">Now Pending With</th>
          <th class="px-2 py-3 text-sm">Workflow progress</th>
          <th scope="col" class="px-6 py-3 text-sm">
            Actions
          </th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngIf="tableDataValue?.length == 0; else showSubmissions">
          <th colspan="12" role="row" class="px-5 py-10 text-lg text-center">
            It seems there is no data to show here!
          </th>
        </ng-container>
        <ng-template #showSubmissions>
          <ng-container *ngFor="let data of tableDataValue; let i = index; let first = first; let last = last; trackBy: trackByFn">
            <tr class="bg-white border-b border-gray-300">
              <td class="px-4 py-4">
                {{showStatus(data?.submissionStatus)}}
              </td>
              <td class="px-2 py-4">
                {{data?.submissionStatus === 1 ? data?.createdBy?.fullName : data?.summaryData?.userName || ''}}
              </td>
                <td class="px-2 py-4 max-w-60">
                  <ng-container *ngFor="let pending of getPendingOnUsers(data?.summaryData?.pendingOnUsers || []); let lastUser = last">
                    <span>{{pending}}<span *ngIf="!lastUser">,</span> &nbsp;</span>
                  </ng-container>
                </td>
              <td class="flex justify-between px-2 py-4">
                <progress
                  tuiProgressBar
                  [color]="changeProgressColor(data?.summaryData?.progress)"
                  max="100"
                  size="s"
                  class="w-9/12 mt-1.5"
                  [value]="data?.summaryData?.progress"
                ></progress>
                <span>{{data?.summaryData?.progress | number : '1.1-2'}} %</span>
              </td>
              <td class="px-6 py-4">
                <!--EDIT-->
                <a
                  title="Edit"
                  (click)="editWorkflowRoute(data?.id, data?.formIds[0]?.key)"
                  *ngIf="checkIfUserisActiveUser(data?.workflowStatus) == true"
                  class="px-2 py-1 ml-2 text-xs font-medium text-white no-underline bg-green-400 rounded-md cursor-pointer hover:text-white">
                  <i class="fa fa-edit fa-lg" aria-hidden="true"></i>
                </a>
                <!--VIEW-->
                <a
                  title="View"
                  (click)="editWorkflowRoute(data?.id, data?.formIds[0]?.key)"
                  *ngIf="(checkIfUserisActiveUser(data?.workflowStatus) == false && checkIfUserisPartofWorkflow(data?.workflowAllUsers) == true) || currentUser?.role == 'admin'"
                  class="px-2 py-1 ml-2 text-xs font-medium text-white no-underline bg-green-400 rounded-md cursor-pointer hover:text-white">
                  <i class="fa fa-eye fa-lg" aria-hidden="true"></i>
                </a>
                <!--Delete-->
                <a
                  title="Delete"
                  (click)="showDialog(dialog)"
                  class="font-medium ml-2 px-2 py-1 bg-[#cf2729] text-white rounded-md hover:text-white no-underline cursor-pointer text-xs">
                  <i class="fa fa-trash-o fa-lg" aria-hidden="true"></i>
                </a>
              </td>
            </tr>
          </ng-container>
        </ng-template>
      </tbody>
    </table>
    <div class="pt-10 pb-6">
      <tui-pagination
        [length]="tableData?.totalPages || 1"
        [index]="tableData?.page - 1 || 0"
        (indexChange)="goToPage($event)"
      ></tui-pagination>
    </div>
  </div>
</ng-container>

<ng-template #noData>
  <app-table-loader></app-table-loader>
</ng-template>

<ng-template #dialog let-observer>
  <p class="text-lg font-semibold text-center mb-5">
    Delete Submission
  </p>
  <p class="text-base font-semibold text-center">
    You are about to <span class="text-red-500">Delete</span> this submission. Are you sure you want to continue?
  </p>
  <div class="flex flex-col justify-center my-5">
    <label class="block" for="Textarea1">Comments <sup>(optional)</sup></label>
    <textarea [formControl]="remarks" class="form-control" id="Textarea1" rows="4"></textarea>
  </div>
  <div class="flex justify-start gap-2">
    <button
      tuiButton
      type="button"
      size="m"
      (click)="observer.complete()"
    >
      Confirm
    </button>
    <button
      tuiButton
      appearance="secondary-destructive"
      type="button"
      size="m"
      (click)="remarks.reset(); observer.complete()"
    >
      Cancel
    </button>
  </div>
</ng-template>